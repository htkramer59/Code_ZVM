/* COL XEDIT V1.17/Program Name - XEDIT Column Editing/VM; Licensed Material - Program Property of IBM Copyright (c)IBM Corp 1991*/trace 'o';Parse Upper Arg v6 '(' .;Parse Arg v7;Call l5;Call lu;Do Forever;Call l4;Do Externals();Parse External .;End;If L(v5)>0 Then Call le v5;Else If sc.0=0 Then;If L(v5)=0 Then Do;If q5='Y' Then NOP;Else Do;c'READ A N T';If rc=4 Then Do;cd;Call lj E(180);Signal lo;End;End;End;Call md;Call ln;End;lo:;Call nz;Call mi;Exit vq;mi:;cm f;If yp^='OFF' Then Do;cr xd f;cr xe f;If Reserved.0>0 Then Do i=1 To Reserved.0;cr Reserved.i;End;End;If L(v5)=0 Then Do;c'RES';cf f;End;cs'A';cp qs f;cp pf f;cp ovpd f;cs scope.1;Call ly;Call om;If cursor.3<0|vo=cursor.3 Then cu'CM';Else Do;i=cursor.3;If cursor.3>vo then i=i-1;If cursor.4<0 Then cu'F' i;End;Do i=1 To 24;s'PF'i Value('PF'i'.1') Value('PF'i'.2');End;s'LINEN' linend.1 linend.2;cm m1 m2;If yo^='' Then yo;If uv^='' Then uv;cm f;Address command 'DROPBUF' vf;e'CURL';uq=curline.2;curline.2=;Address '' 'GLOBALV SELECT col GET CURLINE.2 LINE.1';If curline.2^='' Then Do;e'FL';If line.1>=flscreen.1&line.1<=flscreen.2|line.1^=0 Then;Do i=line.1 to x4;cl':'i;If rc^=2 Then Leave;End;s'CURL' on curline.2;End;If w5='Y'| w4^='';Then Call lm;If w6^='' then Queue w6;If (w5='Y'|w6^='') Then;Address command 'EXECIO 1 DISKW $COLUTIL $LASTCMD A3 1 (NOTYPE VAR U0';Else Address command 'ERASE $COLUTIL $LASTCMD A';If w4^='' Then Do;ug=uq+w4-vo-1;If ug<lscreen.1-4 then s'CURL' on ug;Else s'CURL' on 7;End;Else Address '' 'GLOBALV SELECT col PURGE';If qv^='' Then c'MSG' xi;cm m1 m2;Return;ly:;s'COLOR' color.6;s'WR ' wrap.1;s'NUL' nulls.1;s'SPILL' spill.1;s'STAY' stay.1;s'SPAN' span.1 span.2 span.3;s'SCAL' s1 s2;s'TABL' t1 t2;If yp='' Then;s'MSGL' msgline.1 msgline.2 msgline.3 msgline.4;If ctlchar.1=on Then Do;s'CTL' attr.1 f;s'CTL' attr.2 f;End;Else s'CTL' f;If yv>4 Then Address command 'SET FULLSCREEN RESUME';Return;l5:;Address command 'QUERY CMSLEVEL (STACK LIFO';Parse Pull yu;Parse Value yu with dummy1 dummy2 yv ',' .;y1='FRENCH';y2='PERIOD';y3='COMMA';v=' ';qs=;v8=;v4=;yk='N';yl=;infocolor='R';pfcolor='W';yp=;If Subword(v6,1,2)='PREFIX SET' Then Do;Push 'CoMmAnD LoCaTe :'W(v6,3) 'COL' W(v6,4);Exit;End;k=I(' 'v6,' PROFILE');If k>0 Then Do;Parse Var v6 a 'PROFILE' yw b;v6=a b;Parse Var v7 a 'profile' . b;v7=a b;Parse Var v7 a 'PROFILE' . b;v7=a b;End;Else yw='PROFCOL';um=I(' 'v6,' NOPROF');If um>0 Then Do;v6=O(v,v6,um,7);v7=O(v,v7,um,7);End;un=I(' 'v6,' NOUNDO');If un>0 Then Do;v6=O(v,v6,un,7);v7=O(v,v7,un,7);End;qz=I(' 'v6,' UNDO');If qz>0 Then Do;v6=O(v,v6,qz,5);v7=O(v,v7,qz,5);End;ul=I(' 'v6,' NOEXIT');If ul>0 Then Do;v6=O(v,v6,ul,7);v7=O(v,v7,ul,7);End;yx=I(' 'v6,' STEP');If yx>0 Then Do;v6=O(v,v6,yx,5);v7=O(v,v7,yx,5);End;xt=;i=I(' 'v6,' MATH');If i>0 Then Do;yk='Y';v6=O(v,v6,i,5);v7=O(v,v7,i,5);i=I(v6,'{');If i>0 Then Do;l=I(v6,'}')-i+1;If l>=1 Then Do;yl=S(v6,i+1,l-2);v6=O(v,v6,i,l);v7=O(v,v7,i,l);End;End;End;i=I(' 'v6,' ATAB');If i>0 Then Do;xt=S(v6,i,5);v6=O(v,v6,i,6);v7=O(v,v7,i,6);End;i=I(' 'v6,' TAB');If i>0 Then Do;xt=S(v6,i,4);v6=O(v,v6,i,5);v7=O(v,v7,i,5);End;i=I(' 'v6,' COMP');If i>0 Then Do;xt=S(v6,i,5);v6=O(v,v6,i,6);v7=O(v,v7,i,6);End;i=I(' 'v6,' TS');xu=;If i>0 Then Do;j=R(W(R(v6,i),1),3);If D(j) Then xu=j;v6=O(v,v6,i,3+L(j));v7=O(v,v7,i,3+L(j));End;za=I(' 'v6,' ITOT');If za>0 Then Do;v6=O(v,v6,za,6);v7=O(v,v7,za,6);End;yz=I(' 'v6,' NOTOT');If yz>0 Then Do;v6=O(v,v6,yz,7);v7=O(v,v7,yz,7);End;xh=;i=I(' 'v6,' 'y1);If i>0 Then Do;xh=y1;v6=O(v,v6,i,7);v7=O(v,v7,i,7);End;i=I(' 'v6,' 'y3);If i>0 Then Do;xh=y3;v6=O(v,v6,i,6);v7=O(v,v7,i,6);End;i=I(' 'v6,' 'y2);If i>0 Then Do;xh=y2;v6=O(v,v6,i,7);v7=O(v,v7,i,7);End;yq=I(' 'v6,' NOINFO');If yq>0 Then Do;v6=O(v,v6,yq,7);v7=O(v,v7,yq,7);End;pu=I(' 'v6,' PREFIX');If pu>0 Then Do;v6=O(v,v6,pu,7);v7=O(v,v7,pu,7);Do Forever;pu=pu+1;If S(v6,pu,1)^='' Then Leave;If pu>80 Then Do;Call lj E(163);pu=0;Leave;End;End;If pu>0 Then Do;i=1;Do Forever;j=S(v6,pu+i,1);If j=v|j='(' Then Leave;i=i+1;End;j=pu;pu=S(v6,j,i);v6=O(v,v6,j,i);v7=O(v,v7,j,i);End;End;Parse Var v7 v7 '(' v5;If v7^='' Then Do;Push v7;'MACRO PARSE 1 TARGET';If rc=0 Then Do;Parse Pull .;Parse pull x3 j;qs=S(v7,x3,j);v7=R(v7,x3+j);Parse Var v7 v8 v4 .;End;Else Call lj E(105);End;If qs='?' Then Do;If yv<5 Then'CMS HELP COLCMSV4 TASK';Else 'CMS HELP COL TASK';Exit;End;Return;lu:;c="COMMAND ";e=c"EXT /";cc=c"CL ";ch=c"C ";cl=c"L ";s=c"SET ";cr=s"RESER ";cu=c"CUR ";cm=s"MSGM ";cp=s"P ";cz=s"Z ";cn=c"NEXT ";cs=c"SCOPE ";cd=c"DELETE ";ce=c"CDELETE ";cf=s"PEND ";yo=;If Queued()>0&ul=0&L(v5)=0 Then Do Queued();Parse Pull yo;If Queued()>1 Then yo;End;sc.0=0;If ul>0&Queued()>0 Then Do;sc.0=Queued();Do k=sc.0 to 1 by-1;Parse Pull sc.k;If U(S(sc.k,1,3))^='COL'&U(S(sc.k,1,4))^='ECOL' Then sc.k='COLXED' sc.k;End;End;wt=Queued();Address command 'MAKEBUF';vf=rc;If yv>4 Then Address command 'SET FULLSCREEN SUSPEND';e'PRE S *';j=0;Do i=1 To prefix.0;If W(prefix.i,2)='PREFIXH';Then Do;j=j+1;vs.j=W(prefix.i,1);End;End;vs.0=j;j=0;Do i=1 To prefix.0;If W(prefix.i,2)='PREFIXH2';Then Do;j=j+1;vr.j=W(prefix.i,1);End;End;vr.0=j;If vs.0=0&vr.0=0 Then Do;s'PRE SYN H  PREFIXH';s'PRE SYN HH PREFIXH';vs.0=2;vs.1='HH';vs.2='H';End;w6=;w5=;w4=;scale.1=;scale.2=;p4=;qa=;u5=;wu=;qr=;uv=;ui=;cursor.1=;cursor.4=;q3=;cursor.7=;cursor.8=1;qd=;qe=;py=;pz=;uw=0;vn=0;uc=0;vp=0;ud=0;vq=0;last_command=;ys=;wn=0;si=0;y7=;y6=;ya=;mathinprocess=;cm.1='DD';cm.2='CC';cm.3='MM';cm.4='XX';cm.5='LL';cm.6='KK';cm.7='EE';cm.8='NN';cm.9='++';cm.10='__';cm.11='\\';cm.12='!!';cm.0=12;on='ON';f='OFF';vt='N';vk='N';math_emsg=;decimal=y2;deca=;digits=12;store='N';pn=":-'IORQiorq";vx='|'X2C('11');prefixsymbol='<<->>';symbol='?';po=' ';pw='@';tab_space=2;xq=;v9=qs;auto_exit=f;auto_insert=f;ssp=2;ctlchar.2=;ctlchar.3=;e'MSGM/V/Z/SPILL/MSGL/LR/ARB/UNIQ/SCOPE'|| '/PF*/LINEN/SCAL/CURL/STAY/RESER */TERM'|| '/NUL/TR/WR/DISP/SPAN/TABL/CTL/LS/VAR/STR/COLOR *';If terminal.1^='DISPLAY' Then yq=1;gp=uniqueid.1 'U$N$D$O$ A';m1=msgmode.1;m2=msgmode.2;t1=tabline.1;t2=tabline.2;s1=scale.1;s2=scale.2;p3=verify.2;pa=zone.1 zone.2;qx=trunc.1;us=zone.1;ut=zone.2;pd=zone.1;pe=zone.2;If L(v5)>Z() Then cz pd pd+L(v5)-1;Address command 'STATE $COLUTIL $LASTCMD A3';If rc=0 Then Address Command 'EXECIO 1 DISKR $COLUTIL $LASTCMD A3 1 (NOTYPE VAR U0';Else u0=C(symbol,Z());If yv<5 Then;s'PF1 CMS HELP COLCMSV4 TASK';Else;s'PF1 CMS HELP COL TASK';s'PF2 $COLLIST';s'PF3 QUIT';s'PF15 QUIT';yb='*.<>+-=';vb='|@#$ %^&()+-"º\:;}{/' '¡÷õôèíéúÊËä£ð§Ñ… ­¼æòó”*“ý¤–ø·¶¸?µ¯®_ÙùŒ[]‡—ïÀÚ¿Ä' '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ' "abcdefghijklmnopqrstuvwxyz'!*";esc=S(vb,V(vb,ctlchar.2||ctlchar.3||linend.2||'%'),1);attr.1=S(vb,V(vb,ctlchar.2||ctlchar.3||esc||linend.2||'%'),1);attr.2=S(vb,V(vb,ctlchar.2||ctlchar.3||esc||attr.1||linend.2||'%'),1);If s1=f Then Do;If curline.2>3 Then s'SCAL ON' curline.2-1;Else s'SCAL ON' curline.2+1;End;s'NUL' f;cm f;If L(v5)=0 Then pp=on;Else pp=f;If um=0 Then Do;Address command 'SET CMSTYPE HT';If yw^='PROFCOL' Then Address command 'STATE' yw 'XEDIT *';If rc^=0 Then Do;vq=rc;Call lj E(178,yw);Signal lo;End;Address command 'EXECIO * DISKR' yw 'XEDIT * 1 (NOTYPE STEM PROFCOL.';Address command 'SET CMSTYPE RT';If profcol.0>0 Then Do n=1 To profcol.0;Interpret U(profcol.n);End;If Symbol('BLANK_CHAR')='VAR' Then po=BLANK_CHAR;If Symbol('UNDO_OPTION')='VAR' Then pp=UNDO_OPTION;If Symbol('TARGET')='VAR' Then qs=TARGET;If Symbol('SENTENCE_SPACE')='VAR' Then ssp=SENTENCE_SPACE;If Symbol('INFOLOC')='VAR' Then yp=INFOLOC;End;Call lx;qo=E(1);qp=E(2,esc||attr.2);qq=E(3,esc||attr.1,esc||attr.2,esc||attr.1);If xh^='' then decimal=xh;If xu^='' then tab_space=xu;If un>0 Then pp=f;If qz>0 Then pp=on;If v8^='' Then symbol=v8;If yq>0 Then yp=f;If za>0 Then auto_insert=on;If yz>0 Then auto_insert=f;If v4^='' Then po=v4;If po=symbol|U(symbol)='Y'|symbol='=' Then Call lj E(102) E(103) E(104);If v9^='' Then qs=v9;If qs='' Then qs=1;symbol=S(symbol,1,1);po=S(po,1,1);prefixsymbol=S(prefixsymbol,1,5);pp=U(Left(pp,3));yp=U(yp);e'LI/EFN/EFT/EFM/SCAL';sc1=scale.1;sc2=scale.2;wa=Space(efname.1 eftype.1 efmode.1,1);x3=line.1;vo=line.1;w2=line.1;If pu^=0 Then Queue 'PRF . .' line.1 pu;If xt^='' Then Queue  'PRF . . 0' xt;If x3=0 Then Do;cn;e'LI';x3=line.1;If qs=1 Then qs=2;cl'-1';End;If I(qs,':')>0 Then cs'A';cl qs;If rc>1 Then Do;vq=rc;Call lj 'COL'T(Format(vq,3),'0',v)'E' E(105);Signal lo;End;e'LI';x4=line.1;If x4<x3 Then Do;pg=x3;x3=x4+1;x4=pg+1;cl':'x4;vo=x3;End;If x4=1 Then x4=2;qs='.COLEND';ovpd='.OCOLEND';wl='.TPREFX';s'DISP' display.1 display.2;cp qs;ur=x4;cp ovpd;cs'A';pf='.COLSTRT';cl':'x3;cl'-1';cp pf;cn;cs'D';If S(qs,1,1)=':' then s'DISP 0 *';If x4-x3>5000&pp=on Then;Call lk E(113);cl'.COLDUMMY';If rc=0 Then Do;e'LI';If x3>=line.1 Then x3=x3-1;If x4>=line.1 Then x4=x4-1;vo=x3;c'DEL';End;Address command 'STATE' gp;If rc=0 Then  vt='Y';Return;lx:;s'WR' f;s'SPILL' f;s'STAY ON';s'LINEN' f;s'SPAN' f;If ctlchar.1=on Then Do;esc=ctlchar.2;va=V(vb,ctlchar.2||ctlchar.3||esc||linend.2||'%');If va>0 Then attr.1=S(vb,va,1);va=V(vb,ctlchar.||ctlchar.3||esc||attr.1||linend.2||'%');If va>0 Then attr.2=S(vb,va,1);End;Else s'CTL' esc 'E';s'CTL' attr.1 'P' pfcolor 'H';s'CTL' attr.2 'P' infocolor 'N';If yp='' Then;s'MSGL ON 1 2 O';Return;og:;If yp='OFF' Then Return;e'CMD';If CMDLINE.2^=2 Then Do;xd=1;xe=2;End;Else Do;xe=lscreen.1;xd=lscreen.1-1;End;If yp^='' Then Do;xd=yp;xe=xd+1;End;cr xd f;cr xe f;If qo^=''&yp^='OFF' Then;cr xd infocolor 'N' qo;If vk='N' Then;If qp^=' '&yp^='OFF' Then;cr xe pfcolor 'H' qp;Else NOP;Else;If qq^=' '&yp^='OFF' Then;cr xe infocolor 'N' qq;Return;l4:;yy=-2;Call om;If yo^='' Then Call l6;e'LI';u9=line.1;cm m1 m2;If cursor.3=line.1 Then cu'CM';If L(v5)=0&yo^='' Then Do;e'Z/TR/V';j=zone.1;jj=zone.2;k=trunc.1;l=verify.2;s'LINEN' linend.1 linend.2;yo;yy=-1;e'LINEN/Z/TR/V';If zone.1^=j|zone.2^=jj Then pa=zone.1 zone.2;If trunc.1^=k Then qx=trunc.1;If verify.2^=l Then p3=verify.2;s'LINEN' f;End;If uv^='' Then Do;uv;uv=;End;e'EFN/EFT/EFM';If rc=6 Then Do;Address command 'DROPBUF' vf;Call nz;Exit;End;If Space(efname.1 eftype.1 efmode.1,1)^=wa Then Call m8;cm f;e'LI';If u9^=line.1 Then q8='N';e'Z/ARB';pd=zone.1;pe=zone.2;us=pd;ut=pe;ot.0=0;ol.0=0;If L(v5)>0&v5='' Then v5=C(v,Z());If ui^='' Then cl':'ui;e'LI';up=vo;vo=line.1;Call nu;If vo<x3 Then vo=x3;If vo>x4 Then vo=x4;If vo^=up Then w2=vo;If vk^='N' Then Do;e'Z';pd=zone.1;pe=zone.2;End;Call og;Call m4;cl'-1';cp wl;cf on prefixsymbol;cl qs;cp' .BPREFX';cf on prefixsymbol;Call om;e'ALT';c'UP';c'I' v;cc':' pd;If vk='N' Then Call le C(symbol,Z());Else Do;x1=S(T(x1,symbol,v),pd,Z());Call le x1;End;If q4='Y' Then Do;x1=S(u0,pd,Z());Call le x1;End;e'LI/PRE/SCAL/VERS';w2=line.1;If cursor.3<0&cursor.4<0 Then cursor.4=ya;Else ya=cursor.4;If cursor.1=''|cursor.7='' Then cursor.7=line.1;If cursor.4='' Then cursor.4=1;If si=0 Then Do;If q8='N' Then;If cursor.3=w2 Then cu'CM';Else cu'F' w2 Max(cursor.4,pd,vershift.1+1);Else cu'F' cursor.7 Max(cursor.8,pd,vershift.1+1);If rc^=0 Then cu'F' w2 Max(cursor.4,pd,vershift.1+1);End;If cursor.1^='' Then Do;If cursor.1=scale.3 Then Do;cursor.1=cursor.1+1;If cursor.1=curline.2 Then cursor.1=cursor.1+1;End;If prefix.1^=f Then Do;wn=wn-vershift.1;If prefix.2='LEFT'&cursor.2<7 Then;cu'S' cursor.1 Max(7,wn+6);If prefix.2='RIGHT'&cursor.2>74 Then;cu'S' cursor.1 Max(1,wn);End;End;s'ALT' alt.1 alt.2;Return;nu:;cl qs;If rc<2 Then Do;e'LI';a=line.1;cl ovpd;If rc<2 Then Do;e'LI';If line.1^=a Then Do;cp qs f;cp qs;End;End;End;Else Do;cs'A';cl qs;r=rc;cs'D';If r<2 Then Do;e'LI';cp qs f;Call nt;End;Else Do;cl ovpd;If rc<2 Then cp qs;Else Do;cs'A';cl ovpd;r=rc;cs'D';If r<2 Then Do;e'LI';Call nt;End;Else Do;cl':'ur;If rc<2 Then Do;cp qs;cp ovpd;End;Else Do;cs'A';cl':'ur;cp ovpd;e'LI';cs'D';Call nt;End;End;End;End;End;e'LI';x4=line.1;Return;nt:;e'RAN';Do Forever;cl':'line.1;If rc<2 Then Leave;line.1=line.1+1;If line.1>range.2+1 Then Leave;End;cp qs;Return;om:;Do ub=vo To x4;cl':'ub;If rc=0 Then Leave;End;Return;md:;wj=vk;vk='N';q8='N';wp='Y';wm='Y';wo='Y';pb=;pc=;xm=;ym=;qy=0;wu=;px=0;not='N';y0='N';xj='N';xk='N';xl='N';stx=;If L(v5)=0 Then Do;yo=;uv=;End;ui=;q4=;q5=;uy=0;e'CURS/CURL/LI';c3=C3();vo=line.1;xn=c3;x1=T(c3,v,symbol);If x1^='' Then si=0;If V(S(c3,pd,Z()),symbol)>0 Then u0=c3;e'ALT';s'PENDING' f;cd;s'ALT' alt.1 alt.2;cl wl;cf f;cp wl f;cl'.BPREFX';cf f;cp' .BPREFX' f;Call m4;If si=0 Then If cursor.3>line.1 then cu'F' cursor.3-1 cursor.4;Do While Queued()>wt|sc.0>0;If sc.0=0 Then Parse Pull prefix pm;Select;When sc.0>0 Then Do;k=sc.0;pm=sc.k;sc.0=sc.0-1;q8='Y';If yx>0 Then Do;'GLOBALV SELECT COL SETL PENDING' wj;'GLOBALV SELECT COL SETL CMDLINE' x1;Call m4;cl'-1';cf on prefixsymbol;cl qs;cf on prefixsymbol;Call m4;'MACRO COLDEMO$' symbol po pm;If rc^=0 Then Do;'DESBUF';Signal lo;End;Call m4;cl'-1';cf f;cl qs;cf f;Call m4;End;Select;When U(pm)='ECOL' Then Signal lo;When W(U(pm),1)='COLCMD' Then Do;Parse Var pm . x1;x1=Strip(x1);xn=x1;If pd>1 Then x1=C(symbol,pd-1)||x1;c3=Left(x1,lrecl.1,symbol);x1=T(c3,v,symbol);End;When W(U(pm),1)='COLPRF' Then Do;If W(pm,3)='' Then Do;pm='. . 0 'W(pm,2);Call ng;End;Else Do;cl W(pm,3);If rc<2 Then Do;e'LI';u9=line.1+1;q3=W(pm,2);Call n3;End;End;End;When W(U(pm),1)='COLPCM' Then Do;Parse Var pm . pm x1;x1=Strip(x1);If pd>1 Then x1=C(symbol,pd-1)||x1;c3=Left(x1,lrecl.1,symbol);xn=c3;x1=T(c3,v,symbol);pm='. . 0' pm;ys=1;Call ng;ys=;End;When W(U(pm),1)='COLXED' Then Do;Parse Var pm . yo;cursor.3=0;End;When W(U(pm),1)='COLXCM' Then Do;Parse Var pm . text '{' yo '}' w1;If text='' Then x1=Strip(w1);Else x1=Strip(text);If pd>1 Then x1=C(symbol,pd-1)||x1;yo=Strip(yo);If S(yo,1,1)='^' Then Do;not='Y';yo=R(yo,2);End;c3=Left(x1,lrecl.1,symbol);x1=T(c3,v,symbol);xn=x1;Call ol;End;When W(U(pm),1)='COLMAT' Then Do;Parse Var pm . text '{' yo '}' w1;If text='' Then x1=Strip(w1);Else x1=Strip(text);If pd>1 Then x1=C(symbol,pd-1)||x1;Call o9;End;Otherwise NOP;End;Leave;End;When prefix='CMD'&A('COLPREF',W(U(pm),1),4) Then Do;prefix='PRF';Parse var pm . pm;pm=. . vo pm;Call ng;End;When prefix='CMD'&pm^=v Then Do;If ym='Y' Then Leave;If U(pm)='ECOL' Then Signal lo;stx=C(' ',vershift.1)||pm;yo=Strip(pm);If S(yo,1,1)='^' Then Do;not='Y';yo=R(yo,2);End;If U(W(pm,1))='CMS' Then Leave;If U(W(pm,1))='CP' Then Leave;If V(S(xn,pd,Z()),symbol||'Y^')>0 Then Do;Select;When A('QUIT',U(yo),1) Then NOP;When A('QQUIT',U(yo),2) Then NOP;When A('SAVE',U(yo),4) Then NOP;When A('SSAVE',U(yo),5) Then NOP;When A('FILE',U(yo),4) Then NOP;When A('FFILE',U(yo),5) Then NOP;Otherwise Call ol;End;End;q8='Y';End;When prefix='PAK' Then Do;Parse Var pm . uv;q8='Y';End;When prefix='PFK' Then Call nh;When prefix='PRF' Then Call ng;When prefix='FIL' Then q8='Y';Otherwise NOP;End;End;If yk='Y' Then Call o9;If store='Y'&(xm^=''|T(xn,v,symbol)^='') Then Do;ss=Left(xm,5) S(xn,pd,Z());Address command 'EXECIO 1 DISKW COL CMDLOG A (VAR SS';Address command 'FINIS COL CMDLOG A';End;wd=U(S(Strip(x1,"L"),1,1));If w5='Y'| w4^='' Then Signal lo;If wd="Y"|wd="^" Then Return;Call lm;If si=0 Then c'LPREFIX';cs'A';c'TOP';cl pf;If rc>1 Then Do;cl':'x3;cl yy;cp pf;End;e'LI';If x3^=line.1+1 Then x3=line.1+1;cs'D';Return;ol:;c'LPREFIX';s'RAN :'x3 ':'x4-1;pm='. . 0 COLXC';Address command 'GLOBALV SETL COLXCMD' yo;Address command 'GLOBALV SETL COLLINE' linend.1;Address command 'GLOBALV SETL COLMSGM' m1 m2;ys=1;Call ng;ys=;yo=;c'LPREFIX';s'RAN-* *';Return;nh:;Parse Var pm pfn uv;q8='Y';If pfn=1 Then vt='N';If uv='QUIT' Then Do;q8='N';uv=;End;If uv='$COLLIST' Then Do;uv=;Call m3;q8='Y';End;If pfn=3|pfn=15 Then Signal lo;Return;ng:;pq=line.1;e'SCOPE/LI';Parse Var pm . . u9 q3;xm=q3;If S(q3,1,1)^='.' Then q3=U(q3);If q3=prefixsymbol Then Return;q3=P(q3);u3=symbol;wz=po;qu=T(q3,v,'AIFPD0123456789');If (u9=0|u9=pq|pu^=0)& (qu^=''|D(qu)| c3=''| V(c3,symbol)^=0);Then Call nf;Else Do;c'SCOPE' 'ALL';q3=xm;Call n3;End;q8='Y';cs scope.1;Return;nf:;Select;When S(q3,1,2)='TS' Then Do;If Datatype(R(q3,3),'W')&R(q3,3)>=0 Then Do;tab_space=R(q3,3);If xt=' ' Then Call lk E(114,tab_space);End;Else Call lj E(115,R(q3,3));End;When S(q3,1,3)='TAB' Then Do;If t1=f Then s'TABL' sc1 sc2;Call ms;Call n9;xq=W(S(q3,4,2),1);If xq='' Then xq=v;Call n8;End;When S(q3,1,4)='ATAB' Then Do;Call ms;xq=S(xm,5,1);Call n7;End;When A('TRIGH',q3,2) Then Call o1;When A('TLEFT',q3,2) Then Call o1;When A('TCENT',q3,2) Then Call o1;When A('TBOTH',q3,2) Then Call o1;When S(q3,1,4)='COMP' Then Do;Call ms;Call n9;If S(q3,5,1)^='' Then;xq=S(q3,5,1);c'COMP :'x4;s'TABL' t1 t2;If xq='' Then;'MACRO ALTER 05 40 :'x4 '*';Else;'MACRO ALTER 05' xq ':'x4 '*';End;When A('MATH',q3,2) Then yk='Y';When S(q3,1,3)='DIG' Then Do;If D(S(q3,4,2)) Then Do;digits=Max(S(q3,4,2),9);Call lk E(116,digits);End;End;When q3='STORE' Then Do;store='Y';xm=;Call lk E(117);End;When A('NOSTO',q3,3) Then Do;store='N';xm=;Call lk E(118);End;When q3='PERIO' Then Do;decimal='PEROID';Call lk E(119,y2);End;When q3=y3 Then Do;decimal=y3;Call lk E(119,y3);End;When q3='FRENC' Then Do;decimal=y1;Call lk E(119,y1);End;When Abbrev('RESET',q3) Then Do;vk='N';x1=v;wn=1;ym='Y';End;When q3='?' Then Do;q4='Y';End;When q3='=' Then Do;q5='Y';q4='Y';End;When q3='\' Then Do;Call ms;Call o3;End;When q3='ALL' Then Call na;When Abbrev('UNDO ',q3) Then Do;If vt='Y'&pp=on Then Call mr;If pp=f Then Do;pp=on;Call lk E(121);End;Else If vt='N' Then Do;Call lj E(122);End;End;When A('NOUND',q3,3) Then Do;pp=f;Call lk E(123);Call nz;End;When A('TRANS',q3,4) Then Do;Call ms;If x1^=''&V(x1,';'v)=0 Then Do;Call mj;Call mo;x1=;End;Call o5;End;When S(q3,1,3)='PIC' Then Do;e'ALT';If V(S(q3,5,1),'U ')>0 Then;xn=S(xm,5,1)||symbol;If V(S(q3,4,1),'T ')>0 Then;xn=Strip(S(xm,4,2))||symbol;Call o6;s'ALT' alt.1-1 alt.2-1;q4='Y';End;When q3='Z' Then Do;cz pa;Call lk E(127,pa);End;When q3='T' Then Do;s'TR' qx;Call lk E(128,qx);End;When q3='V' Then Do;s'VERIFY' p3;Call lk E(129,p3);End;When S(q3,1,1)='S'& L(q3)<=2& V(c3,symbol)=0;Then symbol=S(q3,2,1);When S(q3,1,1)='B'& L(q3)<=2;Then po=S(q3,2,1);When q3=pw Then;Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'PEND * :'ii ':'ii;If pending.0^=0&pending.2=pw Then Do;cf f;cf on P(pending.5);End;End;When S(q3,1,4)='ITOT' Then Do;auto_insert=on;Call lk E(173,on);End;When q3='NOTOT' Then Do;auto_insert=f;Call lk E(173,f);End;When q3='DEMO' Then Address command 'EXEC COLDEMO';When q3='ECOL' Then Signal lo;Otherwise;If wj='N' Then Call ne;Else Do;c'SCOPE' 'ALL';If T(q3,v,'AIFPD0123456789')='' Then;Call n3;Else If yo^='' Then yo;End;s'ALT' alt.1-1 alt.2-1;End;If u3^=symbol Then Do;Call lk E(131,symbol);u0=T(u0,symbol,u3);End;If wz^=po Then Call lk E(132,po);If (u3^=symbol|wz^=po)& po=symbol Then Call lj E(102) E(103) E(104);Return;ne:;k=I(x1,'!(');If k>0&R(x1,k+2)='' Then Return;If u9=0&ys=''&pu=0 Then Return;pu=0;If x1=''&q3='COLXC' Then x1=c3;j1=Verify(c3,symbol,,pd);If q3='' Then Return;e'CASE/DISP';j2=0;If j1=0&c3='' Then Do;j1=pd;j2=pe;End;If j1=0|V(S(xn,pd,Z()),symbol)=0 Then Do;yo=q3;Return;End;Else If j2=0 Then j2=Y();x1=T(c3,v,po);x2=0;If M(q3,'*')>0 Then Do;y0='Y';q3=T(q3,v,'*');End;If M(q3,'^')>0 Then Do;not='Y';q3=T(q3,v,'^');End;If M(q3,'>')>0 Then Do;xj='Y';q3=T(q3,v,'>');End;If M(q3,'<')>0 Then Do;xk='Y';q3=T(q3,v,'<');End;If M(q3,'=')>0 Then Do;xl='Y';q3=T(q3,v,'=');End;qu=M(q3,'@+-');If qu>0 Then Call ni;If q3='' Then Return;If case.2='IGNORE' Then x1=U(x1);jj=j2-j1+1;tt=S(x1,j1,jj);If^D(tt) Then;Call n6;qu=tt;u6=j2-j1+1;If y0='Y' Then Do;j2=pe;jj=pe-j1+1;End;Call ms;e'DISP/SEL';If S(q3,1,1)='S' Then Do;If select.2=0 Then Return;cs'A';End;If S(q3,1,1)='X' Then cs'A';If D(R(q3,2)) Then yt=R(q3,2);Else yt=1;Call nd;s'DISP' display.1 display.2;cs'D';If U(W(yo,1))='MATH' Then Do;Parse var yo . yo;Call o9;End;Else;If I(U(yo),'Y.')>0 Then Call o9;Else;If yk='Y' Then Call o9;Else;If x2=0&L(v5)=0&sc.0=0 Then Do;q4='Y';'?';If I(U(yo),'Y.')>0 Then Call lj E(170);Else Call lj E(133,q3);End;Else If L(v5)=0&q3^=''&sc.0=0 Then Do;If W(q3,1)='COLXC' Then Do;Address command 'GLOBALV GET COLXCMD';Call lk E(168,colxcmd,x2);End;Else Call lk E(134,q3,x2);If px^=0 Then Call lk E(164,px);End;x1=;If q3='/' Then Do;e'LI';vo=line.1;cursor.7=vo;End;Return;ni:;If S(q3,qu,1)=pw Then;qu=qu+1;pt=W(T(R(q3,qu),v,S(vb,84,26)),1);If pt^=''&^D(pt) Then Do;Call lj E(135,q3);q3=;x1=;q4='Y';End;q3=T(q3,v,pw);q3=W(P(O(v,q3,qu,L(pt))),1);If N(q3)=1&pt='' Then Do;q3=P(T(q3,v,pw));If S(q3,1,1)=S(q3,2,1) Then;q3=pw||q3;End;Else If D(pt) Then Do;px=pt;If q3='' Then Return;If S(q3,1,1)=S(q3,2,1) Then;q3=pw||q3;End;Return;nd:;s'VAR' f;If xj='N'& xk='N'& xl='N'& I(qu,symbol)=0 Then Call o7;Else Do;If jj<256&px=0&ul=0&S(q3,1,1)^='S' Then Do;Call nl qs j1 jj;Do Queued()-ve;Parse Pull tt;Call nn;cn;End;Address command 'DROPBUF' tempvf;End;Else Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'CURL';c3=C3();tt=S(c3,j1,jj);Call nn;End;End;s'VAR' varblank.1;Return;o7:;If y0='N' Then cz j1 j2;Else cz j1 pe;p0=S(vb,V(vb,qu||linend.2||esc||attr.1||attr.2||v),1);Call m4;e'CURL';c3=C3();If case.2='IGNORE' Then Do;c3=U(c3);tt=U(qu);End;cl'-1';Do Forever;If not='N' Then;cl p0||qu||p0;Else cl'^'p0||qu||p0;If rc>0 Then Leave;e'LI';If line.1>=x4 Then Leave;If px^=0 Then e'LI';Call o8;If px^=0 Then cl':'line.1;End;cz pd pe;Return;nn:;If case.2='IGNORE' Then Do;tt=U(tt);c3=U(c3);End;If D(qu)&^D(tt)&tt^='' Then;Call n6;If not='Y' Then xb='N';Else xb='Y';If xj='Y'|xk='Y' Then xb='N';If I(qu,symbol)=0 Then Do;jk=D(qu)&D(tt);Select;When xj='Y' Then Call nb;When xk='Y' Then Call nc;Otherwise;If I(tt,qu)=0 Then;If not='N' Then xb='N';Else xb='Y';End;End;Else If y0='N' Then;Do jjj=j1 to j2;kk=S(x1,jjj,1);If kk=symbol Then Iterate;If  S(tt,jjj-j1+1,1)^=kk Then Do;If not='N' Then xb='N';Else xb='Y';Leave;End;End;Else;Do Forever;jjj=I(tt,S(x1,j1,1));If jjj>0 Then Do;If not='Y' Then xb='N';Else xb='Y';End;Else Do;If not='N' Then xb='N';Else xb='Y';Leave;End;tt=O(' ',tt,jjj,1);Do jj=j1+1 to j1+u6;kk=S(x1,jj,1);If kk=symbol Then Iterate;If  S(tt,jjj+jj-j1,1)^=kk Then Do;If not='N' Then xb='N';Else xb='Y';Leave;End;End;If xb='Y' Then Leave;End;If xb='Y' Then Call o8;Return;o8:;x2=x2+1;If px^=0 Then cl px;Select;When S(q3,1,1)='X' Then Do;s'SEL' display.2+1 yt;vt='N';End;When S(q3,1,1)='S' Then Do;s'SEL' display.1 yt;vt='N';End;Otherwise cf on q3;End;Return;nb:;If xl='Y' Then;Select;When jk Then;If tt>=qu Then xb='Y';Else xb='N';Otherwise;If "V"||tt>="V"||qu Then xb='Y';Else xb='N';End;Else;Select;When jk Then;If tt>qu Then xb='Y';Else xb='N';Otherwise;If "V"||tt>"V"||qu Then xb='Y';Else xb='N';End;Return;nc:;If xl='Y' Then;Select;When jk Then;If tt<=qu Then xb='Y';Else xb='N';Otherwise;If "V"||tt<="V"||qu Then xb='Y';Else xb='N';End;Else;Select;When jk Then;If tt<qu Then xb='Y';Else xb='N';Otherwise;If "V"||tt<"V"||qu Then xb='Y';Else xb='N';End;Return;n6:;xv=tt;Do Forever;k1=I(tt,'$');If k1=0 Then Leave;If k1^=0 Then tt=Delstr(tt,k1,1);End;If decimal=y3 Then tt=T(tt,',.','.,');If decimal=y1 Then tt=T(tt,',.',' ,');Do Forever;k1=I(tt,',');If k1=0 Then Leave;If k1^=0 Then tt=Delstr(tt,k1,1);End;If^D(tt) Then tt=xv;Return;n3:;uy=uy+1;If vs.0>0 Then qu=T(q3,,'0123456789*');Do i=1 to vs.0;If U(qu)=vs.i Then;w5='Y';End;Do i=1 to vr.0;If U(qu)=vr.i Then;w4=u9;End;If u9^=vo|U(qu)^='D' Then;If u9>=vo&pu=0 Then u9=u9-1;cl':'u9;cp' .COL'uy;ux.uy=q3;Return;lm:;If uy=0 Then Return;si=0;uh=cursor.1;Call om;cp' .COLTACK';kk=;Do uz=1 To uy;If ux.uz='/' Then ui=u9;c'SCOPE' 'ALL';cl'.COL'uz;If rc=2 Then Iterate;cp' .COL'uz f;If yv<5 Then;Select;When Left(ux.uz,1)='S' Then Do;e'LI/DISP';ph=line.1;cs'D';e'LI';cs'A';c'L :'ph;s'SEL' display.1 line.1-ph;End;When ux.uz='' Then NOP;Otherwise Do;If M(U(ux.uz),'AI')>0 Then Do;If line.1+1>=vo Then uh=cursor.1+1;e'LI';If line.1+1=vo Then kk=line.1+1;End;If ux.uz='/'|M(U(ux.uz),'D')>0 Then;uh=;cm m1 m2;cf on ux.uz;c'SCOPE' scope.1;c'LPREFIX';cm f;End;End;Else Do;e'LI';If ux.uz='' Then NOP;Else Do;If M(U(ux.uz),'AIFP')>0 Then Do;If line.1+1>=vo Then uh=cursor.1+1;e'LI';If line.1+1=vo Then kk=line.1+1;End;cm m1 m2;cf on ux.uz;c'SCOPE' scope.1;c'LPREFIX';If U(ux.uz)='SI' Then si=1;cm f;If ux.uz='/'|M(U(ux.uz),'D')>0 Then Do;uh=;If ux.uz='/' Then Do;cs'A';cp' .COLTACK' f;cp' .COLTACK';cs'D';End;Else Do;cs'A';cl'.COLTACK';If rc>1 Then cp' .COLTACK';cs'D';End;End;End;End;c'SCOPE' scope.1;End;cursor.1=uh;cs'A';cl'.COLTACK';cp' .COLTACK' f;e'LI';If vo^=line.1 Then ui=line.1;If kk^='' Then Do;vo=kk;ui=kk;End;If vo>x4 Then x4=vo;cs'D';Return;ln:;e'P *';Do k=1 To point.0;Parse Var point.k . kk cqu .;If cqu='COLSTRT' Then k1=kk;If cqu='COLEND' Then k2=kk-1;End;If k1>=k2 Then Do;x1='';q4='Y';Call lj E(179);End;e'TERM';If terminal.1^='DISPLAY'&yp^=f Then Do;Call lj E(136);Signal lo;End;If x1='' Then Do;If q8='Y'|auto_exit=f Then Do;uw=0;vn=0;uc=0;End;Else Signal lo;End;Else Do;e'ALT';If M(S(W(x1,1)||'X',1,1),'yY^')=0 Then;Call ms;Call n1;Call l3;Call mj;If uw>0|vn>0|uc>0 Then vk='Y';Call lc;Call m7;Call mo;Call ml;Call m0;s'ALT' alt.1 alt.2;End;If y7='Y' Then Do;y7=;Call o3;End;If xt^=''&ul=0 Then Signal lo;xt=;If L(v5)>0& ul=0& vk='N' Then Signal lo;v5=;Return;l6:;j=0;Do k=1 to Words(yo);If W(U(yo),k)='COL' Then j=k;End;If j=0 Then Return;If j>2 Then Return;If A('XEDIT',U(W(yo,1)),1) Then Return;If U(W(yo,1))='ERASE' Then Return;If A('FILELIST',U(W(yo,1)),5) Then Return;If A('COPYFILE',U(W(yo,1)),4) Then Return;If A('RENAME',U(W(yo,1)),1) Then Return;c'UP';c'I' v;cp' .COLDUMMY';w6=yo;yo=;Signal lo;lq:;Parse arg v0 vg;If S(v0,1,1)=':' Then Do;v0=R(v0,2);If vg^=-1&v0>=vo Then vg=-vg;v0=v0+vg;cl':'v0;If rc<=1 Then Return;End;Call lj pi E(105);Return;mj:;vz='N';If V(x1,'Zz* ')=0 Then Do;y8=lrecl.1;y9=V(x1,v);End;Else Do;y8=pe;y9=Max(V(x1,v),pd);If y9>1 Then;If M(S(x1,y9-1,1),"-'IORFiorf")=1 Then;y9=y9-1;End;If y9>1 Then Do;text=S(x1,1,y9-1);If text^='' Then Call lj E(169,Strip(text));End;If y8<lrecl.1 Then Do;text=R(x1,y8+1);If text^='' Then Call lj E(169,Strip(text));End;Do i=y9 to y8;If i=0 Then i=1;Parse Upper Value S(x1,i,1) With cmd;If R(x1,i)=v Then Leave;If cmd=v Then Iterate;If D(cmd) Then Iterate;Select;When cmd='=' Then Call o9;When cmd='\' Then Call n4;When cmd='/' Then Call n2;When cmd=';' Then Call mn;When cmd='"' Then Call lg;When cmd='+' Then Call l1;When cmd="'" Then Call mb;When cmd='-' Then Call mb;When cmd='^' Then Call ll;When cmd='_' Then Call lh;When cmd='!' Then Call lh;When cmd='A' Then Call l0;When cmd='B' Then Call me;When cmd='C' Then Call lb;When cmd='D' Then Call lf;When cmd='E' Then Call lh;When cmd='F' Then Call lr;When cmd='G' Then Call mk;When cmd='H' Then Call mt;When cmd='I' Then Call lv;When cmd='J' Then Call lz;When cmd='K' Then Call m5;When cmd='L' Then Call m5;When cmd='M' Then Call m6;When cmd='N' Then Call m9;When cmd='O' Then Call ma;When cmd='P' Then Call mc;When cmd='Q' Then Call lp;When cmd='R' Then Call mf;When cmd='S' Then Call mk;When cmd='T' Then Call mq;When cmd='U' Then Call ls;When cmd='V' Then Call mu;When cmd='W' Then Call mv;When cmd='<' Then Call mv;When cmd='>' Then Call mv;When cmd='X' Then Call mp;When cmd='Y' Then Call ll;When cmd='Z' Then Call mx;When cmd='(' Then Call o9;When cmd=po Then NOP;Otherwise Do;i=pe;q4='Y';Call lj E(137,cmd);End;End;Call m4;End;Return;n2:;x1=O(v,x1,i,1);w0=W(R(x1,i+1),1);e'VERS/PRE/LS/V';If lscreen.0^=0 Then k=lscreen.2;Else k=80;If prefix.1^=f Then k=k-7;k=Min(k,W(verify.2,2)-W(verify.2,1)+1);If D(w0) Then Do;If w0<0 Then c'LEFT' Abs(w0);If rc^=0 Then c'LEFT 0';If w0=0 Then c'RIGHT 0';If w0>0 Then c'RIGHT' w0;j=rc;x1=O(v,x1,i+1,L(w0));If j^=0|vershift.1=pe Then Do;Call lj E(138);c'RIGHT' pe-W(verify.2,1)+1-k;End;If vershift.1<0 then c'LEFT 0';End;Else If w0='*' Then Do;c'RIGHT' pe-W(verify.2,1)+1-k-vershift.1;x1=O(v,x1,i+1,1);End;Else If w0='-*' Then Do;c'RIGHT 0';x1=O(v,x1,i+1,2);End;Else Do;If S(x1,i+1,1)='' Then Do;c'RIGHT 0';If i>vershift.1+1 then c'RIGHT' i-1;End;Else vz='Y';End;If vz='N' Then Do;alt.1=alt.1-1;alt.2=alt.2-1;End;Return;n1:;If (I(U(x1),'Y')>0&I(x1,'=')>0)|S(Strip(x1),1,1)='=' Then Return;If M(S(P(T(x1,'  ','Zz')),1,1),'/'||pn)^=0 Then Return;j=0;Do until k=0;k=I(x1,'(');If k>0 Then Do;If S(x1,k-1,1)='!' Then n=Verify(xn,')'symbol,'M',k);Else n=Verify(x1,') ','M',k);If n=0 Then n=pe+1;j=j+1;ol.j=k;If S(x1,k-1,1)='!' Then ot.1=K(S(x1,k+1,n-k-1));Else ot.j=S(x1,k+1,n-k-1);x1=O(v,x1,k,n-k+1);ol.0=ol.0+1;ot.0=ot.0+1;End;End;Return;l3:;If M(S(P(x1),1,1),pn)^=0 Then Return;If S(P(x1),1,1)='/' Then;If M(S(P(x1),2,1),pn)^=0 Then Return;Parse Upper Var x1 vj;qm='<<';Call mm;qm='>>';Call mm;qm='ww';Call mm;Call nj '<';If rc=1 Then Return;Call nj '>';If rc=1 Then Return;Call nj 'W';If rc=1 Then Return;Call nj 'w';If rc=1 Then Return;qm='++';Call mm;Call blockc1;Do x=1 To cm.0;dd1=Pos(cm.x,vj);Do While dd1>0;dd2=Pos(cm.x,vj,dd1+2);If dd2>0 Then Do;x1=O('  ',x1,dd2,2);x1=Overlay(dd2-dd1+2,x1,dd1+1);Parse Upper Var x1 vj;dd1=Pos(cm.x,vj);End;Else dd1=0;End;End;Return;blockc1:;Parse Upper Var x1 vj;Do x=1 To cm.0;Do Forever;x2=3;dd1=Pos(C(S(cm.x,1,1),x2),vj);If dd1=0 Then Leave;Do Forever;If C(S(cm.x,1,1),x2+1)=S(vj,dd1,x2+1);Then x2=x2+1;Else Leave;End;x1=O(v,x1,dd1+1,x2-1);x1=Overlay(x2,x1,dd1+1);Parse Upper Var x1 vj;End;End;Return;nj:;Parse Arg a;wr=I(x1,a||a);ws=Index(x1,a||a,wr+2);If wr>0&ws>0 Then Do;x1=O(U(a)' ',x1,wr,2);x1=O(' 'U(a),x1,ws,2);Return 1;End;Return 0;mm:;dd1=0;x1=T(x1,U(qm),qm);Do Until dd1=0;dd1=dd1+1;dd1=Pos(U(qm),x1,dd1);If dd1>1 Then;If S(U(x1),dd1-1,2)='SZ'| S(U(x1),dd1-1,2)='GZ'| S(U(x1),dd1-1,2)='Z<'| S(U(x1),dd1-1,2)='Z>'| S(U(x1),dd1-1,2)='ZW';Then x1=O(v,x1,dd1,1);Do While dd1>0;If S(U(x1),dd1+1,2)=U(qm)| S(U(x1),dd1+1,2)='ZS'| S(U(x1),dd1+1,2)='ZG'| S(U(x1),dd1+1,2)='<Z'| S(U(x1),dd1+1,2)='>Z'| S(U(x1),dd1+1,2)='WZ' Then Do;x1=O(v,x1,dd1+1,1);dd1=dd1+1;End;Else Leave;End;End;Return;lc:;If uw=0|vn=0 Then Return;If vn>1 Then;If U(S(x1,vn-1,1))='C' Then Do;vn=vn-1;vp=vp+1;End;vk='N';ins=uw;If vp<256 Then Do;Call nl qs vn vp;Do Queued()-ve;Parse Pull xb;Call lw;cn;End;Address command 'DROPBUF' tempvf;End;Else;Do j=x3 To x4-1;cl':'j;If rc=2 Then Iterate;e'CURL';xb=S(curline.3,vn,vp);Call lw;End;If t='I' Then;x1=Insert(C(v,L(xb)),x1,i);vn=0;vp=0;uw=0;Return;m7:;If uc>1 Then Do;q1=U(S(x1,uc-1,1));If q1='M'|q1='X' Then Do;uc=uc-1;ud=ud+1;End;End;If uw>0&uc>0 Then Do;vk='N';If uw>uc+ud&ns='D' Then ins=uw-ud;Else ins=uw;If ud<256 Then Do;Call nl qs uc ud;Call nr;Do Queued()-ve;Parse Pull xb;Call lw;cn;End;Address command 'DROPBUF' tempvf;End;Else;Do j=x3 To x4-1;cl':'j;If rc=2 Then Iterate;e'CURL';xb=S(curline.3,uc,ud);If ns='D' Then Do;x1=O(ud||v,x1,i+1,ud);cc':'uc;ce ud;End;If ns='B' Then Do;x1=O(C('_',ud),v,uc,ud);cc':'uc;Call ld C(v,ud);End;Call lw;End;If t='I' Then;x1=Insert(C(v,L(xb)),x1,i);uc=0;ud=0;uw=0;End;Return;nr:;If ns='D' Then Do;i=uc;x1=O(ud||v,x1,i+1,ud);Call lf;End;If ns='B' Then Do;x1=O(C('_',ud),v,uc,ud);i=uc-1;Call ma;End;Call m4;Return;n9:;Do i=pd To pe;If S(x1,i,1)=';' Then Call mn;End;Call mo;Return;mo:;If p4^='' Then Do;p5=T(p4,v,'H');p2=N(p5);If p2%2^=p2/2 Then vk='Y';Else s'V' verify.1 p4;p4=;End;If qr^='' Then Do;s'TABS' qr;qr=;End;Return;ml:;If qa='' Then Return;c'RES';vk='N';p2=N(qa);If p2=1 Then Do;p2=2;qa=qa qa;qe=qe qe;End;If qd='' Then;Do i=1 to Max(1,N(qe)%2);qd=qd i;End;qu=;Do i=1 to N(qe)-1 by 2;If W(qe,i)^=W(qe,i+1) Then qu='Y';End;If(p2^=N(qd)*2|qu='Y')& xc^='Y';Then;Do;qe=pz;qa=py;p2=N(qa);If qd=1 Then;Do i=2 to Max(1,N(qe)%2);qd=qd i;End;End;If p2^=N(qd)*2 Then Do;Call lj E(139);vk='Y';qa=;qd=;qe=;py=;pz=;q4='Y';Return;End;qb=;Do i=1 to N(qd);Do j=1 to N(qd);If j=1 then uk=W(qd,1);Else uk=min(uk,W(qd,j));End;qg=I(qd,uk);qd=O(v,qd,qg,1);qg=qg-1;qb=qb W(qe,qg) W(qa,qg) W(qa,qg+1);End;qh=1;If M(qb,'A')>0&M(qb,'D')>0 |ol.0>0 Then qh=2;Else qb=S(qb,1,2) R(T(qb,'  ','AD'),3);If p2%2^=p2/2 Then Do;vk='Y';q4='Y';End;Else Do;e'SEL';If pd=1&pe=trunc.1&select.2=0 Then qi='X';Else Do;Call l9;c'LPREFIX   ';qi='C';End;Do Forever;If qh=1 Then qc=qb;Else Do;wy=Max(Lastpos('A',qb),"LASTPOS"('D',qb));qc=R(qb,wy);qb=S(qb,1,wy-1);End;If ol.0>0 Then;Do j=1 to ol.0;If W( qc,3)+1=ol.j Then Do;ot.j=U(ot.j);If ot.j='X' Then ot.j='H';If ot.j='Z' Then qc=qc 'Z' Subword(qc,2);Else qc=ot.j qc;End;End;If qi='X' Then;c'MACRO SORT' qs qc;Else;c'MACRO SORT :'x4-xw qc;r=rc;If r>1 Then Do;vq=r;e'LAST';Call lj lastmsg.1;End;If r>1&ol.0>0 Then Do;Call lj E(140);End;If qh=1|N(qb)=0 then Leave;End;End;If qi='C' then;Call la;qa=;qd=;qe=;py=;pz=;cz pa;Return;lf:;w0=S(x1,i+1,1);Call mz;cc':'i;If w0=v|U(n)='D'|D(n) Then Do;If^D(n) Then n=1;x1=Delstr(x1,i,Abs(n));Call m4;ce n;c'REPEAT' qs;End;Else Do;s'VAR' f;s'STR' f;k=0;w0=K(T(R(x1,i+1),v,po));x1=Delstr(x1,i);Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;ce w0;If rc=5 Then Do;Call lj E(181,w0);Leave;End;If rc=0 Then k=k+1;End;s'VAR' varblank.1;s'STR' stream.1;If w0^='*' Then Call lk E(182,w0,k);End;i=i-1;c3=x1;Return;l0:;Call my;cc':'i;If^D(n) Then n=1;If vz='Y' Then cc':'i-1;Else cc':'i+1;xb=C(v,n);Call m4;Call n5 xb;Call nk 'I';If U(S(x1,i+1,1))='A' Then x1=O(v,x1,i,1);Else Do;x1=O(v,x1,i,L(n)+1);vz=;End;If y6='' Then x1=Insert(C(v,n),x1,i);Return;lv:;Call n0;If po^='' Then Do;xb=T(K(xb),v,po);j=L(xb);If j=0 Then Do;xb=v;j=1;End;End;Else Do;jj=Pos('I',U(xn));j=Pos(symbol,xn,jj+1)-(jj+1);If j<0 Then j=Min(trunc.1,pe)-i;If j=0 Then j=1;xb=S(x1,i+1,j);End;If vz='Y' Then cc':'i-1;Else cc':'i+1;Call m4;Call n5 xb;Call nk 'I';x1=O(v,x1,i,j+1);x1=Insert(C(v,j),x1,i+1);Return;mf:;Call n0;xb=K(xb);If po^='' Then Do;xb=T(K(xb),v,po);j=L(xb);End;Else Do;jj=Pos('R',U(xn));j=Pos(symbol,xn,jj+1)-(jj+1);If j<0 then j=Min(trunc.1,pe)-i;If j<=0 Then Do;Call lj E(106);vk='Y';Return;End;xb=S(x1,i+1,j);End;If vz='Y' Then cc':'i-1;Else cc':'i+1;Call m4;Call le xb;Call nk 'R';x1=O(v,x1,i,j+1);xn=O(v,xn,i,j+1);Return;nk:;Parse Arg a;Call m4;cn;e'LI';Do ii=line.1 to x4-1;cl':'ii;If rc=2 Then Iterate;Select;When a='I' Then Call n5 xb;When a='R' Then Call le xb;When a='O' Then Call ld xb;Otherwise NOP;End;End;If qy>0 Then;Call lj E(141,qy);Return;mb:;If I(U(x1),'Y')>0&I(x1,'=')>0 Then Return;Call n0;xb=K(xb);If xb='' Then Do;If cmd="'" Then;Call lj E(112);Else Call lj E(111);vk='Y';Return;End;xb=T(xb,v,po);n=L(xb);If vz='Y' Then j=i-1;Else j=i+1;cz' 1 *';cl qs;e'LI';Do k=x3 To line.1-1;cl':'k;If rc=2 Then Iterate;e'CURL';c3=C3();Do kk=1 To n;If cmd="'" Then;If S(c3,kk+j-1,1)=v Then;c3=O(S(xb,kk,1),c3,kk+j-1,1);If cmd="-" Then;If S(c3,kk+j-1,1)=S(xb,kk,1)| (S(xb,kk,1)=arbchar.2&arbchar.1='ON') Then;c3=O(v,c3,kk+j-1,1);Else If S(xb,1,1)='' Then Leave;End;cc':1';Call le c3;End;cz' 'pd pe;x1=O(v,x1,i,n+1);Return;m5:;Call mz;If^D(n) Then n=i;Else n=i+n-1;e'TR';If n>trunc.1 Then n=trunc.1;cz i n;If cmd='L' Then c'LOWER' qs;Else c'UPPER' qs;cz pd pe;Return;mk:;x1=T(x1,v,'()');Do Forever;qf=M(x1,'0123456789');If qf=0 Then Do;xc='N';If pz^='' Then Do;jj=0;Do ii=pd to pe;If U(S(x1,ii,1))='Z' Then Iterate;If S(x1,ii,1)^=v Then jj=jj+1;End;If jj>N(pz) Then xc='Y';Leave;End;Do j=pd to pe;If S(x1,j,1)=''| S(x1,j,1)='Z' Then Nop;Else Do;w1=S(x1,j,1);py=py j;If U(S(x1,j,1))='S' Then;pz=pz 'A';Else pz=pz 'D';Do jj=j to pe;If S(x1,jj+1,1)^=w1 Then;Do;py=py jj;If U(S(x1,jj,1))='S' Then;pz=pz 'A';Else pz=pz 'D';Leave;End;End;j=jj;End;End;Leave;End;multipass=1;qd=qd S(x1,qf,1);If qf=1|S(x1,Max(1,qf-1),1)=v Then;py=py qf+1;Else Do;Do j=qf-1 to pd by-1;If S(x1,j,1)=v Then Leave;End;If j=pd then j=j-1;py=py j+1;End;If U(S(x1,qf+1,1))='S'| U(S(x1,Max(1,qf-1),1))='S' Then;pz=pz 'A';Else pz=pz 'D';py=py Max(qf,Index(x1,v,qf+1)-1);If U(S(x1,qf+1,1))='S'| U(S(x1,Max(1,qf-1),1))='S' Then;pz=pz 'A';Else pz=pz 'D';Select;When U(S(x1,Max(1,qf-1),1))='S' then;x1=O('S',x1,qf,1);When U(S(x1,Max(1,qf-1),1))='G' then;x1=O('G',x1,qf,1);Otherwise x1=O(v,x1,qf,1);End;End;qm='ss';Call mm;qm='gg';Call mm;qa=qa i;If cmd='S' Then qe=qe 'A';Else qe=qe 'D';Return;ma:;Call n0;xb=T(xb,v,po);n=L(xb);If xb='' Then Do;Call lj E(107);Call lj E(142);vk='Y';Return;End;If vz='Y' Then Do;cc':'i-1;x1=O(v,x1,i-1,n+2);End;Else Do;cc':'i+1;If i=0 Then vh=1;Else vh=i;x1=O(v,x1,vh,n+1);End;Call m4;Call ld xb;Call nk 'O';Return;lw:;cc':'ins;If t='I' Then  Call n5  xb;If t='R' Then  Call le xb;Return;lg:;If I(U(x1),'Y')>0&I(x1,'=')>0 Then Return;If S(x1,i,3)='"" '&Pos(' ""',x1,i+2)>0;Then x2=Pos(' ""',x1,i+2)+2-i+1;Else Do;x2=1;Do Forever;If C('"',x2+1)=S(x1,i,x2+1);Then x2=x2+1;Else Leave;End;If x2>4 Then x1=O(v,x1,i+2,x2-4);End;u6=0;ue=Verify(x1,'1234567890','M',i+x2);If ue>0&ue<=i+x2+1 Then Do;uf=Verify(x1,'1234567890',,ue);n=S(x1,ue,uf-ue);u6=L(n);End;Else n=1;t='I';x1=O(v,x1,i,x2+u6);ins=i+x2;If x2<256 Then Do;Call nl qs i x2;Do Queued()-ve;Parse Pull xb;If n>1 Then xb=C(xb,n);Call lw;cn;End;Address command 'DROPBUF' tempvf;End;Else;Do j=x3 To x4-1;cl':'j;If rc=2 Then Iterate;e'CURL';xb=S(curline.3,uc,ud);Call lw;End;x1=Insert(C(v,L(xb)),x1,i);Return;lb:;vn=i;Call mz;If^D(n) Then vp=1;Else vp=n;Return;m6:;ns='D';uc=i;Call mz;If^D(n) Then ud=1;Else ud=n;Return;mp:;Call m6;ns='B';Return;lr:;x1=U(x1);x1=T(x1,v,'F');uw=i+1;t='I';Return;mc:;x1=U(x1);x1=T(x1,v,'P');uw=i;t='I';Return;ls:;x1=U(x1);x1=T(x1,v,'U');uw=i;t='R';Return;mq:;If S(x1,i+1,1)='' Then s'TR' i;Call op;Return;mx:;qm='zz';Call mm;Call op;If wp='Y' Then Do;pb=i;If S(x1,i+1,1)='*' Then Do;pc=lrecl.1;cz pb pc;pd=pb;pe=pc;x1=O(v,x1,i,2);Return;End;wp='N';vk='Y';End;Else Do;pc=i;wp='Y';vk='N';cz pb pc;pd=pb;pe=pc;End;Return;l1:;Numeric Digits Max(digits,9);Call my;If wm='Y'&^D(n) Then Do;wm='N';v2=i;vk='Y';End;Else Do;If ol.0>0 Then Do ii=1 to ol.0;ot.ii=U(ot.ii);If I(ot.ii,'\')>0 Then Do;Call o3;y7='Y';ot.ii=Strip(T(ot.ii,v,'\'));End;If V(Strip(ot.ii),'LCS')>0|ot.ii=''|L(ot.ii)>1 Then Do;Call lj E(101);q4='Y';vk='N';Numeric Digits 9;Return;End;End;wm='Y';If D(n) Then Do;v2=i;v3=i+n-1;End;Else v3=i;vk='N';qv=0;x2=0;w7='N';vv='N';xi=;v1=v3-v2+1;Call o4 i+1 1;If v1<256 Then Do;Call nl qs v2 v1;Do Queued()-ve;Parse Pull pm;pm=T(pm,,vx);rr=pm;If Queued()=ve Then rr=;Call np;Call nw;cn;End;Address command 'DROPBUF' tempvf;End;Else Do;cl qs;e'LI';x4=line.1;Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'CURL';pm=T(S(curline.3,v2,v1),vx);rr=pm;If ii=x4-1 Then rr=;Call np;Call nw;End;End;If ol.0=0 Then Call nv;If y7='Y' Then Do;y7=;Call o3;End;End;Numeric Digits 9;Return;nw:;If ol.0=0|(ot.1='S'&rr^='') Then Return;pt=qv;Call nv;qv=pt;x2=0;If ot.1^='S' Then xi=;If ot.1^='C' Then qv='0';Return;nv:;vc=0;If x2>0 Then Do;vc=qv/x2;qw=Pos('.',qv);If qw>0 Then;qw=L(qv)-qw+2;Else qw=2;vc=Format(vc,,qw);qk=Format(qk,,qw-2);xa=Format(xa,,qw-2);End;Else Do;If ol.0=0 Then Call lk E(165);xi='0 0 0 0 0 N';Return;End;If vv='Y' Then Do;qv=fmt(qv);vc=fmt(vc);qk=fmt(qk);xa=fmt(xa);End;If w7='Y'&x2>0 Then Do;qv='$'||qv;vc='$'||vc;qk='$'||qk;xa='$'||xa;End;If v5^='' Then Do;If  vc='' Then vc=0;If  qk='' Then qk=0;If  xa='' Then xa=0;xi=xi x2 qv qk xa vc;End;x1=O(v,x1,v2,v1);Call mg;If L(qv)>v1 Then Do;Call lk E(144);Return;End;If ol.0=0 Then Do;cl':'x4;cl'-1';End;e'CURL';c3=C3();If rc<=0 Then Do;qv=P(qv);k=v2+v1-L(qv);If S(c3,k,L(qv)+1)=v Then Do;c3=O(qv,c3,k,L(qv));If pd>1 Then c3=R(c3,pd);Call le c3;If ol.0=0 Then Call lk E(143);xi=xi 'Y';Return;End;End;qv=Right(qv,v1);Do jj=x4-1 To x4;cl':'x4;If jj^=x4 Then cl'-1';If rc>0 Then Iterate;e'CURL';c3=C3();If S(c3,v2,v1)=v Then Do;c3=O(qv,c3,v2,v1);If pd>1 Then c3=R(c3,pd);Call le c3;If ol.0=0 Then Call lk E(143);xi=xi 'Y';Return;End;End;If auto_insert=on Then Do;cl'-1';c'INPUT' Copies(v,v2-1)||qv;Call lk E(154);End;Else Call lk E(145);xi=xi 'N';Return;o9:;If yl^='' Then yo=yl;yl=;If I(U(x1),'Y')=0&I(x1,'=')=0 Then Return;If I(x1,'=')=0 Then Do;Call lj E(170);q4='Y';If I(U(yo),'Y.') Then '?';Return;End;c3=x1;x1=;Drop y. yn.;y.00='÷';Call lm;yd=Translate(U(c3),'FF'x,'Y'||yb||vb,'00'x);text=T(yd,v,'00'x);yc=T(c3,'000000'x,v||'yY');Call ob;If k=0 Then Do;q4='Y';Call lj E(170);Return;End;Call oa;yc=Overlay('00'x,yc,k,l,'00'x);cc':'k;Call ms;Signal On Syntax;Numeric Digits Max(l,9);p2=0;Do cvairindex=x3 To x4-1;cl':'cvairindex;If rc=2 Then Iterate;Call oc;Call od;End;Signal Off Syntax;Numeric Digits 9;If yo^=''&(p2>0|q4='Y') Then '?';yo=;yk=;Return;ob:;k=0;yf=0;Do i=pd to pe;i=Index(c3,'=',i);If i=0 Then Leave;If k=0|i<M(c3,'yY')|i>pe-M(Reverse(c3),'yY')+1 Then Do;k=i;l=1;Do Forever;i=i+1;If S(c3,i,1)='.' Then yf=i;If M(S(c3,i,1),'='||'.') Then l=l+1;Else Leave;End;End;End;If yf<k|yf>=k+l Then yf=0;Return;oc:;e'CURL';c.3=curline.3;mathinprocess='Y';If yo^='' Then Do;If yn.0=0 Then Do;y.0=S(c.3,k,l);i=1;Do Forever;y.i=WordIndex(text,i);If y.i=0 Then Leave;y.i=S(c.3,y.i,L(W(text,i)));i=i+1;End;End;Else Do;If yn.0^=N(text) Then Do;Call lj E(177);q4='Y';Return;End;Do i=1 to yn.0;j=yn.i;y.j=WordIndex(text,i);If y.j=0 Then Iterate;y.j=S(c.3,y.j,L(W(text,i)));End;End;cvairrun=yo;End;Else cvairrun=T(BitOr(BitAnd(c.3,yd),yc),v,'00FF'x);If y.00='÷' Then Do;y.00=0;If Symbol('Y.1')='VAR'&^D(y.1) Then y.00=v;If y.0^='' Then y.00=y.0;End;ans=Ans(cvairrun);y.00=ans;Return;Ans: Procedure Expose y. cvairrun cvairindex mathinprocess vo cursor.7 q4 p2 terminal.1 yp math_emsg;Interpret 'b='cvairrun;Return b;od:;mathinprocess='F';If D(ans) Then Do;If yf=0 Then Do;i=Index(ans,'.');If i=0 Then i=L(ans)+1;ans=Format(ans,Max(i-1,1),Max(l-i,0));If I(ans,'.')>0 Then ans=Strip(ans,'T','0');ans=Strip(ans,'T','.');If L(ans)>l Then Do;Call lj E(172,ans,cvairindex);ans=C(v,l);q4='Y';p2=p2+1;If p2=1 Then vo=cvairindex;End;Else ans=Right(ans,l);End;Else ans=Format(ans,yf-k,k+l-yf-1);ans=Right(ans,l);End;Else ans=Left(ans,l);mathinprocess=;c'CREPLACE' ans;Return;oa:;yn.0=0;If yo='' Then Return;w1=U(symbol)||'Y=*/+-(&^|%"'"'";w1=Translate(U(c3),v,w1,v);If w1='' Then Return;j=0;Do Forever;j=j+1;Parse Var w1 yn.j w1;If yn.j='.' Then Do;j=j-1;If w1='' Then Leave;Else Iterate;End;i=I(c3,yn.j);c3=Overlay(v,c3,i,L(yn.j),v);If i>1 Then If U(S(c3,i-1,1))='Y' Then c3=Overlay('Y',c3,i,L(yn.j),'Y');yn.j=Strip(T(yn.j,v,'.'));If w1='' Then Leave;End;yn.0=j;yd=Translate(U(c3),'FF'x,'Y'||yb||vb,'00'x);text=T(yd,v,'00'x);Return;np:;If decimal=y3 Then pm=T(pm,',.','.,');If decimal=y1 Then Do;If I(pm,'.')>0 Then deca='Y';pm=T(pm,',.',' ,');End;jj=0;Do Forever;jj=jj+1;Parse Value pm With v.jj pm;If pm='' Then Leave;End;j=0;Do Until j=jj;j=j+1;j1=I(v.j,'$');If j1^=0 Then v.j=Delstr(v.j,j1,1);If j1^=0 Then w7='Y';Do Forever;j2=I(v.j,',');If j2=0 Then Leave;vv='Y';If S(v.j,j2+1,1)=',' Then;v.j=O(v,v.j,j2,1);Else     v.j=Delstr(v.j,j2,1);End;Parse Value v.j With v.j pm;If pm^='' Then;Do Forever;jj=jj+1;Parse Value pm With v.jj pm;If pm='' Then Leave;End;If S(Reverse(v.j),1,1)='-' Then Do;If L(v.j)>1 Then;v.j=Left(v.j,L(v.j)-1);If D(v.j) Then v.j=-v.j;End;If D(v.j);Then Do;If j>1 Then Do;k=j-1;If v.k='-' Then v.j=-v.j;End;qv=qv+v.j;x2=x2+1;If x2=1 Then Do;qk=v.j;xa=v.j;End;Else Do;qk=Min(qk,v.j);xa=Max(xa,v.j);End;End;End;Return;mg:;If ot.0>0 Then Return;If decimal=y3 Then Do;qv=T(qv,',.','.,');vc=T(vc,',.','.,');qk=T(qk,',.','.,');xa=T(xa,',.','.,');End;If decimal=y1 Then Do;If deca='' Then j=',.';Else j=', ';qv=T(qv,' ,',j);vc=T(vc,' ,',j);qk=T(qk,' ,',j);xa=T(xa,' ,',j);End;deca=;Call lk E(146,x2,qv,qk,xa,vc);Return;fmt: Procedure;arg ans;j1=I(ans,'.');If j1=0 Then;Do;j1=L(ans);j1=j1+1;End;j1=j1-4;Do While j1>0;ans=Insert(',',ans,j1);j1=j1-3;End;Return ans;mv:;Call mz;wq=S(x1,i,1);Upper wq;If wo='Y'&D(n)=0 Then Do;wo='N';p8=i;vk='Y';q0=wq;End;Else Do;wo='Y';If D(n) Then Do;Parse Value i i+n-1 With p8 p9;q2=i-1;If q2>0 Then;Do;q0=S(x1,q2,1);If q0='<'| q0='>'| q0='W'| q0='w' Then p8=p8-1;End;End;Else p9=i;If q0='<'&wq='>' Then wq='W';If q0='>'&wq='<' Then wq='C';pd=p8;pe=p9;qm='zz';Call mm;qt=M(x1,'Zz');If qt>0 Then Do;If pd<qt&qt<pe Then pd=qt;Else Signal l2;End;qt=Verify(x1,'Zz','M',qt+1);If qt>0 Then Do;If pd<qt&qt<pe Then pe=qt;Else Signal l2;End;vk='N';cl qs e'LI';x4=line.1;pr.=;p7=p9-p8+1;uj=p7;u4=;w9=;uu=;If p8<pd    Then Do;u4=Left(v,pd-p8);uj=uj-pd+p8;End;If p9>pe Then Do;uj=uj-p9+pe;End;If L(u4)>0 Then;cz us ut;p6=1;Call m4;c'-1';Do ii=1 Until line.1>=x4;c'+1' e'CURL/LI';c3=C3();If line.1<x4 Then Do;pr.ii=;u7=Space(S(c3,p8,p7),1);If w9='Y'&pr.0^=v&u7^=''then;uu='Y';w9=;Do iii=1 To N(u7);pr.ii=W(u7,iii);pr.0=pr.0||pr.ii||v;If M(Right(pr.ii,1),'.!?')=1 Then;If Datatype(W(u7,iii+1),'L')=0|iii=N(u7) Then;Do ssp-1;pr.0=pr.0||v;End;End;End;If (pr.ii=''|line.1>=x4);Then Do;Do p6=p6 By 1 To ii;u8=Lastpos(v,pr.0,uj+1);If u8<=0 Then u8=uj;ps.p6=S(pr.0,1,u8);pr.0=Strip(R(pr.0,u8+1),"L");End;If pr.ii='' Then w9='Y';End;End;If ps.ii^=v Then Signal mw;If uu='Y' Then Call lj E(147);Call m4;c'-1 COMMAND CL :'p8;lins=ii-1;Do ii=1 To lins;jj=ii+1;Select;When wq="W" Then;If ps.jj^=''&ii^=lins Then;pr.ii=J(P(ps.ii),uj);Else pr.ii=Left(K(ps.ii),uj);When wq="<" Then;pr.ii=Left(Strip(ps.ii,'L'),uj);When wq=">" Then;pr.ii=Right(K(ps.ii),uj);When wq="C" Then;pr.ii=Center(K(ps.ii),uj);Otherwise NOP;End;If L(u4)>0 Then;pr.ii=S(u4||pr.ii,1,p7);c'+1';Call le pr.ii;End;End;li:;cz us ut;pd=us;pe=ut;Return;mw:;Call lj ps.ii '. . .';Call lk E(148);q4='Y';Signal li;l2:;Call lj E(149);x1=;q4='Y';Signal li;mu:;qm='vv';Call mm;p4=p4 i;Call op;Return;mt:;qm='hh';Call mm;Call op;If N(p4)>1 Then;If W(p4,N(p4)-1)='H' Then;p4=p4 i;Else p4=p4 'H' i;Else p4=p4 'H' i;Return;mn: qr=qr i;Call op;Return;na:;If V(c3,symbol' ')=0 Then Do;If U(q3)='ALL' Then 'ALL';Return;End;i=V(xn,symbol);cz i pe;'MACRO COLALL /'S(xn,i,pe-i+2-V(Reverse(xn),symbol))'/';cz pd pe;x1=;q3=;s'ALT' alt.1-1 alt.2-1;Return;n4:;Call mz;If^D(n) Then Do;If S(x1,i,2)=cm.11 Then Do;n=2;x1=O('  ',x1,i,2);End;Else Do;Call o3;y7='Y';x1=O(v,x1,i,1);Return;End;End;cc':'i;If n<256 Then Do;Call nl qs i n;Do Queued()-ve;Parse Pull c3;c3=Reverse(c3);Call le c3;cn;End;Address command 'DROPBUF' tempvf;End;Else;Do j=x3 To x4-1;cl':'j;If rc=2 Then Iterate;e'CURL';c3=C3();c3=O(Reverse(S(c3,i,n)),c3,i,n);c3=Reverse(c3);Call le c3;End;Return;lz:;qm='jj';Call mm;u5=u5 i;p1=U(W(R(x1,i),1)||v);qu=Pos('L',p1);If qu=0 Then qu=Pos('R',p1);If qu=0 Then qu=Pos('C',p1);If qu=0 Then qu=Pos('B',p1);If qu^=0 Then Do;k=S(p1,qu,1);If wu=''|wu=k Then wu=k;Else Do;Call lj E(183);q4='Y';u5=;End;x1=O(v,x1,i+qu-1,1);End;If I('LRC',wu)^=0&qu>0 Then Do;ue=M(p1,'1234567890');If ue>0 Then Do;uf=Verify(p1,'1234567890',,ue);wv=S(p1,ue,uf-ue);x1=O(v,x1,i+ue-1,uf-ue);End;Else wv=;End;Return;m0:;If u5='' Then Return;e'Z';ww=zone.1;wx=zone.2;p2=N(u5);Select;When p2=1 Then Do;pd=u5;If wu='' Then Call oi;End;When p2=2 Then;Do;pd=W(u5,1);pe=W(u5,2);If wu='' Then Call oi;End;Otherwise Do;Call lj E(150);vk='Y';u5=;Return;End;End;If wu='' Then Do;u5=;pd=ww;pe=wx;Return;End;wu=S(wu,1,1);If p2=1&wu='C' Then pd=ww;If p2=1&wu='R'| p2=1&wu='B' Then Do;pd=ww;pe=u5;End;cc':'pd;qj=0;e'TR';If lrecl.1<256 Then Do;Call nl ':'x4;Do Queued()-ve;Parse Pull c3;Call lt;cn;End;Address command 'DROPBUF' tempvf;End;Else Do j=x3 To x4-1;c':'j;If rc=2 Then Iterate;e'CURL';c3=C3();Call lt;End;cz ww wx;If qj>0 Then Do;Call lj E(151,qj,wv);Call lk E(152);End;u5=;wu=;Return;oi:;Do forever;Say E(160);Pull wu .;If V(wu,'LCRB')=0&L(wu)<=1 Then Leave;End;If wu^='' Then Do Forever;Say E(161);Say E(162);Pull wv .;If Datatype(wv,'W')|wv='' Then Leave;End;Return;lt:;c3=S(c3,pd,Z());If wu='C' Then;If p2=1 Then Do;w1=P(c3);If wv^='' Then Call oe;w1=Center(w1,u5*2-pd+1);End;Else Do;w1=P(c3);If wv^='' Then Call oe;w1=Center(w1,Z());End;If wu='L' Then Do;w1=P(c3);If wv^='' Then Call oe;w1=S(w1,1,Z());End;If wu='R' Then Do;w1=K(c3);If wv^='' Then Call oe;w1=Right(w1,Z());End;If wu='B' Then;w1=J(c3,Z());If w1^='' Then Do;If L(w1)>231 Then Do;w1=S(w1,1,trunc.1);Call le w1;End;Else c'CREPLACE 'w1;End;Return;oe:;w1=Space(w1,wv);If L(w1)>Z() Then Do;qj=qj+1;w1=J(S(c3,pd,Z()),Z());End;Return;me:;Call oj;Do j=x3 To x4-1;cl':'j cc':'i+1;If rc=2 Then Iterate;cc'-^/ /';e'COL';If column.1<i Then Do;cc':'i;If pe=lrecl.1&pd=1 Then ce column.1-i;Else Do;e'CURLINE';cc':'Max(pd,column.1+1);Call le S(S(curline.3,i+1,pe-i),1,pe-Max(pd-1,column.1));End;End;End;Call ok;Return;lp:;s'VAR' f;s'STR' f;Call oj;q9='Y';j=pos(symbol,c3,i+1)-(i+1);If j<=0 then j=Min(trunc.1,pe)-i;xf=S(x1,i+1,j);if po^=v then;xf=T(K(xf),v,po);x1=O(v,x1,i+1,L(xf));If U(S(xf,1,1))="Q"&L(xf)>1;Then Do;xf=R(xf,2);q9='N';End;If xf='' then xf=v;qy=0;Do j=x3 To x4-1;cl':'j;If rc>1 Then Iterate;cc':'i+L(xf);If xf=v Then cc'-^/ /';w3=V(vb,xf);delim.1=S(vb,w3,1);cc'-'delim.1||xf||delim.1;vi=rc;If vi^=0&xf^=v Then Iterate;If q9='Y' Then Do;If xf=v&vi^=0 Then cc':0';If xf^=v Then cc'-1';End;Else If L(xf)>1 Then;cc L(xf)-1;e'COL';If column.1<i Then Do;cc'+1';k=i-column.1-1;If pe=lrecl.1&pd=1 Then Call n5 C(v,k);Else If column.1+1>=pd Then Do;e'CURLINE';Call le S(C(v,k)||R(curline.3,column.1+1),1,pe-column.1);If S(curline.3,pe-k+1,k)^='' Then qy=qy+1;End;End;End;s'VAR' varblank.1;s'STR' stream.1;If qy>0 Then Do;If pe<lrecl.1 Then Call lj E(156,qy);Else Call lj E(141,qy);End;Call ok;Return;oj:;If wp='N' Then Do;us=pd;ut=pe;pd=pb;pe=Index(x1,'Z',pd+1);If pe<pd Then pe=lrecl.1;x1=O(v,O(v,x1,pe,1),pd,1);End;Return;ok:;If wp='N' Then Do;pd=us;pe=ut;wp='Y';vk='N';End;Return;lh:;If cmd='_' Then Do j=i to pe;If S(x1,j,1)^='_' Then Leave;x1=O('E',x1,j,1);End;If cmd='!' Then Do j=i to pe;If S(x1,j,1)^='!' Then Leave;x1=O('E',x1,j,1);End;If U(S(x1,i,2))='EE' Then;x1=O('E2',x1,i,2);Call o4 i+2 2;Call mz;If^D(n) Then n=1;Call o4 i+n n;q6=;cc':'i;c'STACK' qs i n;Call m4;j=0;k=1;xb=v;If ol.0>0 Then Do;If D(ot.1) Then k=ot.1;Else xb=ot.1;If xb='' Then xb=stx||v;End;Do Queued()-wt;Parse Pull w8;If cmd='!' Then Do;If w8==q6|j=0 Then Do;j=1;q6=w8;cn;Iterate;End;Else Do;q6=w8;cl'-1';Do k;c'INPUT' xb;End;cl'1';End;End;Else;If cmd='_' Then Do;If w8==q6 Then Call le C(v,n);Else q6=w8;End;Else;If w8^='' Then q6=w8;Else Call le q6;cn;End;If y7='Y' Then Do;y7=;Call o3;End;Return;o4:;Parse Arg opn opw;If S(x1,opn,1)^='\' Then Return;If cmd='!' Then Return;x1=O(v,x1,i+opw,1);If y7='Y' Then Return;Call o3;y7='Y';If ol.0>0 Then Do j=1 to ol.0;If ol.j=i+opw+1 Then ol.j=ol.j-1;End;Return;m9:;If U(S(x1,i,2))='NN' Then;x1=O('N2',x1,i,2);Call o4 i+2 2;Call my;If^D(n) Then n=1;Call o4 i+n n;cl qs;e'LI';x4=line.1;cc':'i;uo=;pt=;xy=;xo=0;xp=0;If ol.0>0 Then Do j=1 to ol.0;If ol.j=i+n Then Do;If I(ot.j,'\')>0 Then Do;Call o3;y7='Y';ot.j=T(ot.j,v,'\');End;Parse var ot.j  ot.j ',' xy;uo=T(ot.j,v,'1234567890.-');If L(Strip(uo))>1|V(U(uo),' ABX')>0 Then Do;q4='Y';Call lj E(184);Return;End;pt=W(T(ot.j,v,S(vb,84,26)||R(vb,111,26)),1);ot.j=;ol.j=;End;End;If pt='-' Then pt=-1;If^D(pt) Then pt=1;If uo='' Then q6=pt;Else q6=1;If U(uo)='B' Then q6=0;If U(uo)='A'&pt<0 Then Do;q6=0;Do n;q6=q6+1;q6=q6*26;End;End;If U(uo)='X'&pt<0 Then q6=-16**n-1;If U(uo)='B'&pt<0 Then q6=-2**n-1;xz=q6;If n<256 Then Do;Call nl qs i n;Do Queued()-ve;Parse Pull w8;Call nq;cn;End;Address command 'DROPBUF' tempvf;End;Else;Do j=x3 To x4-1;c':'j e'CURL';If rc=2 Then Iterate;w8=S(curline.3,i,n);Call nq;End;If y7='Y' Then Do;y7=;Call o3;End;Return;SYNTAX:;If mathinprocess^='' Then Do;q4='Y';If mathinprocess='Y' Then Do;i=cvairindex;If i>=vo Then i=i+1;Call lj E(171,i);Call lj '"'Strip(cvairrun)'"';End;Else Do;If i>=vo Then i=i+1;Call lj E(172,ans,i);Call lj;End;p2=p2+1;If p2=1 Then Do;'CoMmAnD ExTrAcT /LI';vo=line.1;cursor.7=vo;End;Return E(175);End;Call lj E(153);Call lk E(154);Return;nq:;If U(uo)='A' Then Do;jj=V(P(U(w8)),S(vb,84,26));If jj^=0&w8^='' Then Do;q6=pt;Return;End;End;If w8^='' Then Do;q6=w8;xz=w8;End;If q6='' Then q6=Right('1',n);If xy^=''&q6>xy Then;q6=xz;w1=;If w8^='' Then Do;xo=Datatype(P(w8),'U');xp=Datatype(P(w8),'L');End;w8=U(w8);Select;When U(uo)='A' Then Do;If w8^='' Then;If jj=0 Then Do;q6=0;m=1;Do k=1 to n;x=S(w8,n-k+1,1);If x='' Then Leave;x=Pos(x,S(vb,84,26));q6=q6+x*m;m=m*26;End;End;If q6<=0 Then Do;k=0;do n;k=k+1;k=k*26;end;q6=k+q6;End;pm=q6%1-1;Do until pm<0;qu=pm//26;pm=pm%26-1;w1=S(vb,84+qu,1)||U(w1);If xp|(uo='a'&^xo) Then;w1=T(w1,R(vb,111),R(vb,84));End;w1=Right(w1,n);End;When U(uo)='X' Then Do;If w8^='' Then;If V(P(w8),S(vb,74,16))=0 Then;q6=X2d(P(w8));If D(q6) Then;If q6>=0 Then w1=Right(D2x(q6),n);Else w1=Right(D2x(q6,n),n);End;When U(uo)='B' Then Do;SIGNAL ON SYNTAX;If w8^='' Then;If V(P(w8),'01')=0 Then;q6=X2d(B2X(Right(P(w8),((n-1)%4+1)*4,'0')));If D(q6) Then;w1=Right(X2b(D2X(q6,n)),n,'0');SIGNAL OFF SYNTAX;End;Otherwise w1=Right(q6,n);End;Call le w1;If D(q6) Then q6=q6+pt;Else q6=;Return;ll:;If I(x1,'=')>0 Then Do;Call o9;Return;End;x1=U(x1);vk='Y';If Pos('Y',x1)=1 Then wn=1;Else wn=Max(pos(v,x1),pos('Y',x1));If Pos('Y',x1)>0&Pos('^',x1)>0 Then Do;Call lj E(155);Call mh;i=pe;Return;End;j=Pos('*',x1,i+1);If j>0 Then;x1=Overlay(cmd,x1,j,pe-i,cmd);i=pe;If uy=1&S(ux.1,1,1)=R(ux.1,2) Then Do;e'PEND BLOCK */';If pending.4^='BLOCK' Then Do;Call lm;Return;End;End;cz' 1 *';wi=U(x1);Do Forever;wk=W(T(wi,v,'Y^'),1);If wk='' Then Leave;If Datatype(wk,'W') Then do;k=Pos(wk,wi);If wk=1 Then wi=O(v,wi,k,1);Else wi=Overlay(cmd,wi,k-1,wk,cmd);x1=wi;End;Else wi= O(v,wi,Pos(wk,wi),L(wk));End;If uy=1&ux.1='/' Then Call lm;Else If uy>0 Then Call ny;If uv^=''&yo='' Then Do;yo=uv;uv=;End;qn=;If S(yo,1,8)=c'' Then Do;qn='COMMAND';yo=R(yo,9);End;If S(yo,1,6)='MACRO ' Then Do;qn='MACRO';yo=R(yo,7);End;If S(yo,1,1)='=' Then yo=T(yo,'?','=');k=U(yo);Select;When k='' Then NOP;When uy>0 Then NOP;When D(k) Then NOP;When D(R(k,2)) Then NOP;When S(k,1,1)='.'&N(k)=1 Then NOP;When A('TOP',k,3) Then NOP;When A('BOTTOM',k,1) Then NOP;When A('UP',k,1) Then NOP;When A('DOWN',k,1) Then NOP;When k='*' Then NOP;When k='-*' Then NOP;When S(k,1,1)='?'Then NOP;When A('QUIT',k,1) Then NOP;When A('QQUIT',k,2) Then NOP;When A('CURSOR',k,3) Then cursor.1=;When A('RIGHT',k,2) Then NOP;When A('LEFT',k,2) Then NOP;When A('FILE',k,4) Then NOP;When A('SAVE',k,4) Then NOP;When A('ALL',k,3) Then NOP;When A('BACKWARD',k,2) Then NOP;When A('FORWARD',k,2) Then NOP;When A('RGTLEFT',k,7) Then NOP;When A('NEXT',k,1) Then NOP;When A('FFILE',k,5) Then NOP;When A('SSAVE',k,5) Then NOP;When A('XEDIT',k,1) Then NOP;When A('CMS',k,3) Then NOP;When A('CP',k,2) Then NOP;When A('CANCEL',k,6) Then NOP;When A('SET',k,3) Then NOP;When A('QUERY',k,1) Then NOP;When A('MODIFY',k,3) Then NOP;When A('SOS',k,3) Then NOP;When A('SCHANGE',k,3) Then Call lj E(166,yo);When A('MSG',k,3) Then NOP;When A('EMSG',k,4) Then NOP;When A('HELP',k,1) Then NOP;When A('SCRUMOD',k,7) Then NOP;When A('SCRDMOD',k,7) Then NOP;Otherwise Call ny;End;cz pd pe;Return;ny:;Call ms;e'SCOPE';cs'A';Call l7;cs'D';c'LPREFIX   ';cs'A';cl qs;cl'-1';e'LI';pq=line.1;vd='Y';If uy>0 Then;Do uz=1 to uy;cl'.COL'uz;e'LI';If line.1<x3 Then Do;cp' .COL'uz f;cl':'x4;cl'-1';cp' .COL'uz;End;If line.1=pq then vd='N';End;Call lm;cl qs;e'LI';If Pos('Y',x1)>0 Then Do;wh=T(wi,'_ ',' Y');wg=T(wi,'FF'X,'Y');End;Else Do;wh=T(wi,'_','^');wg=T(wi,'FF40'X,'405F'X);End;If yo^='' Then Call nx;Do j=x4 to line.1-1;cl':'j;If rc>1 Then Iterate;e'CURL';If T(bitor(wg,curline.3),v,'FF'X)=v Then Iterate;Call ld wh;qy=qy+1;End;If qy>0 Then Call lj E(156,qy);If vd='Y'&line.1-x4>x4-x3 Then Do;cl qs;Do line.1-x4-(x4-x3);cl'-1' e'CURL';If curline.3^='' Then Leave;cd;End;End;If line.1-x4<x4-x3 Then Do;cl qs;If rc=0 Then cl'-1';If terminal.1='DISPLAY' Then;c'ADD' (x4-x3)-(line.1-x4);Else Do (x4-x3)-(line.1-x4);c'I' v;End;End;cs'A';Call la;cs'D';Return;nx:;j1=Pos(' ',wh)-1;j2=0;Do ii=j1+1 to L(wh);If V(wh,'_')=0 Then Leave;If S(wh,ii,1)=' ' Then j2=j2+1;If ii=cursor.4 Then cursor.4=j2;End;j=1;yo=' 'yo;Do Forever;j=Index(yo,' :',j);If j=0 Then Leave;j=j+2;jj=W(R(yo,j),1);If^D(jj) Then Leave;If jj>=x3&jj<=x4 Then Do;yo=Delstr(yo,j,L(jj));If jj>vo Then jj=jj-1;jj=jj+x4-x3;yo=Insert(jj,yo,j-1);End;Else Do;Call lj E(105);yo=;Return;End;End;s'RAN :'x4 ':'line.1-1;cl'-*';c'SH L' j1 '*';c'PRES';cs'D';Call ly;ua=S(T(wh,'D','_'),j1+1,Max(Y()-j1,n));If ua^='' Then Do;pg=x1;u2=x3;x3=x4;x4=line.1;x1=ua;Call blockc1;Call mj;cl'-*';End;s'TR' j2;If cursor.3>0 Then Do;If cursor.3>vo Then cursor.3=cursor.3-1;cursor.3=cursor.3+x4-x3;c'LEFT 0';If cursor.4>1 Then c'RIGHT' cursor.4-1;cl':'cursor.3;cu'F' cursor.3  cursor.4;End;s'LINEN' linend.1 linend.2;cm m1 m2;qn yo;yo=;s'LINEN' f;s'TR *';cz' 1 *';If ua^='' Then Do;ua=R(T(ua,'A','D'),2);x1=ua;Call blockc1;x1=S(x1,1,Wordindex(x1,N(x1))-1);cl qs;e'LI';x4=line.1;y6='Y';Call mj;y6=;x1=pg;x4=x3;x3=u2;End;c'REST';cl'*';e'LI';cl'-*';c'SH R' j1 '*';s'RAN-* *';Call lx;cc':1';Return;n7:;ot.0=0;If lrecl.1<256 Then Do;Call nl qs;Do Queued()-ve;Parse Pull text;Call nm;cn;End;Address command 'DROPBUF' tempvf;End;Else Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'CURL';text=curline.3;Call nm;End;xs=;xr=1;If ot.0>0 Then Do j=1 to ot.0;xr=xr+ot.j+tab_space;xs=xs||xr||v;End;Else Do;Call lj E(109,xq);Return;End;s'TABS' xs;Call m4;Call n8;If t1=f Then s'TABL' sc1 sc2;Return;nm:;If M(xq,text)=0 Then Return;j=0;If Text^='' Then Do Until (text='');j=j+1;If j>ot.0 then ot.j=0;Parse var text w1 (xq) text;ot.j=Max(ot.j,L(w1));End;ot.0=Max(ot.0,j);Return;n8:;If xq='' Then;'MACRO ALTER 40 05 :'x4 '*';Else;'MACRO ALTER' xq '05 :'x4 '*';If rc<2 Then Do;c'EXP :'x4;Call lk E(157,xq);End;Else Call lj E(108,xq);Return;o1:;Call ms;text=curline.3;Call nm;e'TABS/';If N(tabs.1)<1 Then Return;If tabs.1^=1 Then tabs.1=1 tabs.1;If lrecl.1<256 Then Do;Call nl qs;Do Queued()-ve;Parse Pull text;Call o2;cn;End;Address command 'DROPBUF' tempvf;End;Else Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'CURL';text=curline.3;Call o2;End;Return;o2:;Do jj=1 to N(tabs.1)-1;kk=W(tabs.1,jj+1)-W(tabs.1,jj);Select;When A('TRIGH',q3,2) Then;pi=Right(P(S(text,W(tabs.1,jj),kk)),kk);When A('TLEFT',q3,2) Then;pi=Left(P(S(text,W(tabs.1,jj),kk)),kk);When A('TCENT',q3,2) Then;pi=Center(P(S(text,W(tabs.1,jj),kk)),kk);When A('TBOTH',q3,2) Then;pi=J(P(S(text,W(tabs.1,jj),kk)),kk);Otherwise NOP;End;text=O(pi,text,W(tabs.1,jj),kk);Call le text;End;Return;mh:;If uy<1 Then Return;Do uz=1 To uy;ux.uz=;End;Call lm;Return;ms:;If v5^=''&ul=0&qz=0 Then;pp=f;Call m4;If pp=f Then Return;Call nz;c'PUT' qs gp;If rc<=1 Then vt='Y';Else vt='N';If rc=13|rc=100 Then Do;Call lj E(158);Call lk E(159);pp=f;End;Call m4;Return;mr:;e'SEL';If select.2=0 Then Do;Call m4;cd qs;cl'-1';c'GET' gp;If rc^=0 Then Do;Call lj E(124,rc);Call nz;Return;End;Call m4;End;Else Do;e'LI';cs'D';Call m4;cp' .START';cl':'x3-1;If rc<=1 Then c'GET' gp;Else Do;c'i xxxx';cp' .STARTX';cl'-1';c'MOVE 1 1';Call m4;c'GET' gp;cl'.STARTX' cd;End;cl'.START';cp' .START' f;e'LI';x4=line.1;cl':'x4;c'REPLACE     ';c'REPEAT' qs;Call m4;c'MERGE :'x4 ':'x4;cl':' line.1;cs'A';End;Return;nl:;Parse Arg vy;ve=Queued();Address command 'MAKEBUF';tempvf=rc;Call m4;c'STACK' vy;Call m4;Return;o5:;vm=;cl':'x3;If rc>0 Then Return;e'CURL/TABS/W/ALT';If V(curline.3,';'v)=0 Then Do;cd;vm='Y';x4=x4-1;tabs=;Do Forever;ii=V(curline.3,v);If ii>pe Then Leave;tabs=tabs ii;curline.3=Overlay(' ',curline.3,ii);If R(curline.3,ii)=v Then Leave;End;End;Else Do;If tabs.0=0 Then tabs=1;Else tabs=tabs.1;End;If W(tabs,1)^=1 Then tabs=1 tabs;maxwidth=0;vl=W(tabs,N(tabs));Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'CURL';maxwidth=Max(maxwidth,L(Strip(R(curline.3,vl))));End;If maxwidth>0 Then tabs=tabs vl+maxwidth+tab_space;qy=0;Do ii=2 To N(tabs);maxwidth=Max(maxwidth,W(tabs,ii)-W(tabs,ii-1));End;jj=(x4-x3) * maxwidth;If jj>width.1 Then Do;Call lj E(167,jj,width.1);End;s'TABS 1';Do ii=2 to N(tabs);xb=;Do jj=x3 To x4-1;cl':'jj;If rc=2 Then Iterate;e'CURL';xb=xb||S(S(curline.3,W(tabs,ii-1),W(tabs,ii)-W(tabs,ii-1)),1,maxwidth);End;xb=K(xb);If xb='' then xb=v;cl ii-2;If L(xb)<256 Then c'INPUT' xb;Else Do;c'INPUT' v;Call n5 xb;End;End;Call m4;c'DELETE :'x4;If qy>0 Then Do;Call lj E(141,qy);Return;End;xb=;ii=1;Do Forever;jj=ii*maxwidth;If jj>width.1 Then Leave;If vm='Y' Then;xb=O(';',xb,jj+1,1);Else;xb=xb jj+1;ii=ii+1;If ii>x4-x3 Then Leave;If vm^='Y'& If ii>28 Then Leave;End;s'TABS' tabs.1;If vm='Y' Then;cl'-1 COMMAND INPUT' xb;Else;s'TABS' xb;s'ALT' alt.1+1 alt.2+1;If t1=f&vm='' Then s'TABL' sc1 sc2;Return;o6:;e'CASE';xb=;j=V(S(xn,pd,Z()),symbol);If xn='' Then j=0;If j>0 Then Do;jj=Index(xn,symbol,j);If jj>0 Then Do;x1=S(xn,j,jj-j);If case.2='IGNORE' Then x1=U(x1);End;Else j=0;End;x1=T(x1,v,po);e'W';If width.1<256 Then Do;Call nl qs;Do Queued()-ve;Parse Pull tt;If j>0 Then Do;If case.2='IGNORE' Then tt=U(tt);tt=Pt(tt,x1,xb,symbol);End;xb=Bitor(xb,tt);cn;End;Address command 'DROPBUF' tempvf;End;Else Do ii=x3 To x4-1;cl':'ii;If rc=2 Then Iterate;e'CURL';If j>0 Then Do;If case.2='IGNORE' Then curline.3=U(curline.3);curline.3=Pt(curline.3,x1,xb,symbol);End;xb=Bitor(xb,curline.3);End;u0=Translate(xb,v,v||Xrange(),symbol);x1=;Return;Pt:Procedure;Parse Arg a,b,d,e;t=;i=0;c=C(e,L(b));d=S(d,1,L(a));Do Forever;If d^='' Then If Verify(d,e,,i+1)=0 Then Leave;i=Index(a,b,i+1);If i=0 Then Leave;t=Overlay(c,t,i);End;Return t;o3:;cs'A';kk=0;e'SEL/P *';If select.2>0 Then Do jj=x3+1 to x4-1;cl':'jj;e'SEL';kk=kk+1;s.kk=select.1;End;cl':'x4-1 c'DELETE :'x3;c'RECOVER' x4-x3-1;If kk>0 Then Do jj=x3 to x4-2;cl':'jj;s'SEL' s.kk;kk=kk-1;End;Drop s.;If point.0>0 Then Do jj=1 to point.0;t=point.jj;If W(t,2)<x3 Then Iterate;If W(t,2)>=x4  Then Leave;cl':'x4-W(t,2)+1;kk=3;Do While W(t,kk)^='';'SET POINT .'W(t,kk);kk=kk+1;End;End;cs'D';Call m4;Return;l7:;Call l8;s'ARB' f;If cmd='Y' Then Do;we=T(U(wi),p0," ");we=T(we," ","Y");wf=T(U(wi),p0,"Y");End;If cmd='^' Then Do;we=T(U(wi),p0,"^");wf=T(U(wi),p0," ");wf=T(wf," ","^");End;n=L(wi);jj=x3;kk=x4;x3=x4;cl qs;e'LI';x4=line.1;cc':1';cl':'x3;xb=we;Call ld xb;Call nk 'O';x3=jj;x4=kk;cl':'x4;ch'/'p0'/ / 'qs '*';Call m4;xb=wf;Call ld xb;jj=qs;qs=':'x4;Call nk 'O';qs=jj;Call m4;ch'/'p0'/ / :'x4 '*';Call m4;s'ARB' arbchar.1 arbchar.2;Return;l8:;e'ARB/RAN/LI';Do ii=1 To 139;p0=S(vb,ii,1);Call m4;cl'-1';cl'/'p0'/';If rc>1 Then Leave;e'LI';If line.1>=x4 Then Leave;If ii=139 Then Do;Call lj E(130,p0);p0=attr.1;End;End;s'ARB ON 'p0;e'TR';Call m4;cp' .START';c'COPY' qs ':'x3-1;If rc^=0 Then Do;c'i xxxx';cp' .STARTX';cl'-1';c'MOVE 1 1';cl'.START';c'COPY' qs '.STARTX';cl'.STARTX' cd;End;cl'.START';cp' .START' f;e'LI';x4=line.1;xw=ub-x3;e'ARB';Return;l9:;Call l8;Call m4;If pd>1 Then Do;cz' 1' pd-1;ch'/'p0'// :'x4;c'SHIFT RIGHT' pd-1 ':'x4;End;If pe<trunc.1 Then Do;cz pe+1 trunc.1;ch'/'p0'// :'x4;End;cz pd pe;q7=C('x',Z());cl qs;e'LI';Do ii=x4 To line.1-1;cl':'ii;cc':'pd;Call ld q7;End;cl':'x4;ch'/x/ /' qs '*';Call m4;Return;la:;Call m4;c'MERGE :'x4 ':'x4;s'ARB' arbchar.1 arbchar.2;cz us ut;pd=us;pe=ut;Call m4;Return;le:;Parse Arg vy;If L(vy)>231 Then Do;e'COL';Do Until L(vy)<231;c'CREPLACE' S(vy,1,230);cc 230;vy=R(vy,231);End;c'CREPLACE' vy;cc':'column.1;End;Else c'CREPLACE' vy;Return;ld:;Parse Arg vy;If L(vy)>231 Then Do;e'COL';Do Until L(vy)<231;c'COVERLAY' S(vy,1,230);cc 230;vy=R(vy,231);End;c'COVERLAY' vy;cc':'column.1;End;Else c'COVERLAY' vy;Return;n5:;Parse Arg vy;If L(vy)>231 Then Do;e'COL';Do Until L(vy)<231;c'CINSERT' S(vy,1,230);If rc=3 Then Do;qy=qy+1;End;cc 230;vy=R(vy,231);End;c'CINSERT' vy;If rc=3 Then qy=qy+1;cc':'column.1;End;Else Do;c'CINSERT' vy;If rc=3 Then qy=qy+1;End;Return;m4:;Do ub=x3 To x4;cl':'ub;If rc=0 Then Leave;End;Return;op:;alt.1=alt.1-1;alt.2=alt.2-1;s'ALT' alt.1 alt.2;Return;my:;Parse Value R(x1,i+1) With n .;Return;n0:;Parse Value R(x1,i+1) With xb;Return;mz:;Call my;If n='*' Then Do;n=pe-i+1;x1=O(v,x1,i+1,1);End;Return;m8:;yo=;e'NBF/FN/FT/FM';Do nbfile.1;c'X';e'EFN/EFT/EFM';If Space(efname.1 eftype.1 efmode.1,1)=wa Then Do;Call mi;Call oh;Leave;End;End;c'X' fname.1 ftype.1 fmode.1;Address command 'EXECIO 1 DISKW $COLUTIL $LASTCMD A3 1 (NOTYPE VAR U0';Exit;lk: Parse Arg wb;If terminal.1^='DISPLAY' Then Return;If xt=' '&v5=''&ul=0 Then Do;cm m1;c'MSG' wb;cm f;End;Return;oh:;e'CURL/LI';If uq=curline.2&vs.0>0 Then qu=S(C(vs.1,2),1,2);Else qu=S(C(vr.1,2),1,2);cl':'x3;If x3+1=x4 Then;s'PENDING' on S(qu,1,1);Else Do;s'PENDING' on qu;cl':'x4;cl'-1';s'PENDING' on qu;End;cl':'line.1;Call lk E(185);Return;lj:Parse Arg wb;If yp=f Then Return;If mathinprocess='Y'&math_emsg='OFF' Then Return;'CoMmAnD SeT MsGm ON';'CoMmAnD EmSg' wb;'CoMmAnD SeT MsGm OFF';Return;nz:;Address command 'STATE' gp;If rc=0 Then Address command 'ERASE' gp;Return;C3:e'TR';Return Left(curline.3,trunc.1);Y:Return L(x1)-Verify(Reverse(c3),symbol,,L(x1)-pe+1)+1;Z:Return pe-pd+1;A:Procedure;Parse Arg a,b,c;Return 'ABBREV'(a,W(b,1),c);C:Procedure;Parse Arg a,b;Return 'COPIES'(a,b);D:Procedure;Parse Arg a;Return 'DATATYPE'(a,'N');I:Procedure;Parse Arg a,b;Return 'INDEX'(a,b);K:Procedure;Parse Arg a;Return 'STRIP'(a,'T');L:Procedure;Parse Arg a;Return 'LENGTH'(a);M:Procedure;Parse Arg a,b;Return 'VERIFY'(a,b,'M');N:Procedure;Parse Arg a;Return 'WORDS'(a);O:Procedure;Parse Arg a,b,c,d;Return 'OVERLAY'(a,b,c,d);P:Procedure;Parse Arg a;Return 'STRIP'(a);R:Procedure;Parse Arg a,b;Return 'SUBSTR'(a,b);S:Procedure;Parse Arg a,b,c;Return 'SUBSTR'(a,b,c);T:Procedure;Parse Arg a,b,c;Return 'TRANSLATE'(a,b,c);U:Procedure;Arg a;Return a;V:Procedure;Parse Arg a,b;Return 'VERIFY'(a,b);W:Procedure;Parse Arg a,b;Return 'WORD'(a,b);J:Procedure;Parse Arg a,b;Return 'JUSTIFY'(a,b);E:Procedure;Parse Arg n,a.1,a.2,a.3,a.4,a.5;n=Right(n,3,'0');If n<900 Then m='COL'n 'Message not found';Else m=;a.0=0;Do i=1 to 5;If L(a.i)=0 Then Leave;a.0=i;End;Address command 'EXECIO * DISKR COL MESSAGES * 1 (FIND /COL'n'/ ZONE 1 6 STEM M.';If rc=24 Then a.0=0;If rc= 0 Then m=R(m.1,8);If m^='' Then If a.0>0 Then Do;
j=1;Do i=1 to a.0;If j>0 Then j=Index(m,'%',j);If j>0 Then Do;m=Delstr(m,j,1);j=j-1;m=Insert(a.i,m,j);j=j+L(a.i)+1;End;Else m=m a.i;End;End;Return m;Number: Procedure;Arg a;If D(a) Then Return P(a);Else Return 0;m3:;j=1;If po^='' Then Do;Say E(120,po);j=2;End;Do i=j to 200;m=E(i+900);If m=''&i//(lscreen.1-2)=1 Then Do;Say;Leave;End;Say m;End;'VMFCLEAR';Return;
